{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./V3d.Navigation.js","webpack:///./index.js","webpack:///./js/App.js","webpack:///./js/FlowCamera.js","webpack:///./js/Input.js","webpack:///./js/Scene.js","webpack:///./js/lib/getAbsoluteBoundingRect.js","webpack:///./js/lib/keypress.js","webpack:///./js/lib/stats.min.js","webpack:///(webpack)/buildin/global.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;ACnEA,+BAA+B,UAAU,2DAA2D;AACpG,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,yDAAyD,cAAc;AACvE;AACA;AACA;AACA;AACA;AACA,mCAAmC,0BAA0B,EAAE;AAC/D,yCAAyC,eAAe;AACxD;AACA;AACA;AACA;AACA;AACA,8DAA8D,+DAA+D;AAC7H;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,0G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA,e;AACA;AACA;AACA;AACA;AACA;AACA,qCAAmC;AACnC,aAAa;AACb;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,kFAAkF;AAClF,kBAAkB;AAClB;AACA;AACA,8BAA8B;AAC9B,2CAA2C;AAC3C,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA,sBAAsB,OAAO;AAC7B;AACA;AACA,0BAA0B,OAAO;AACjC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,sBAAsB,WAAW;AACjC,0BAA0B,WAAW;AACrC,2CAAyC;AACzC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,iCAAiC;AACjC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,kDAAkD,gBAAgB;AAClE;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,iEAAiE,qBAAqB;AACtF;AACA;AACA;AACA;AACA,8BAA8B,YAAY;AAC1C;AACA,oCAAoC,UAAU;AAC9C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,+EAA+E,cAAc;;AAE7F;AACA;;AAEA,8DAA8D,uEAAuE;AACrI;AACA;AACA;;AAEA;AACA;AACA,8BAA8B,oBAAoB;AAClD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2DAA2D,gBAAgB;AAC3E;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,+BAA+B,mCAAmC;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B,eAAe;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,OAAO;AAC7B,0BAA0B,OAAO;AACjC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,iDAAiD,iBAAiB;AAClE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,YAAY,MAAM;AAClB,YAAY,SAAS;AACrB,YAAY,SAAS;AACrB,YAAY,OAAO;AACnB,YAAY,KAAK;AACjB;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;AAC5B;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,8CAA8C,QAAQ;AACtD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,MAAM;AACjB,WAAW,OAAO;AAClB,WAAW,KAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC;;AAEA,oCAAoC,gBAAgB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,uBAAuB;AACxC;AACA;AACA;;AAEA;AACA,iBAAiB,4BAA4B;AAC7C;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA,kCAAkC;AAClC;AACA;AACA;AACA;;AAEA,cAAc;;AAEd;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,wCAAwC,SAAS;AACjD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B,UAAU;AACrC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,yDAAyD,iBAAiB,EAAE;AAC5E;AACA;;AAEA,CAAC;;;AAGD,OAAO;;AAEP,UAAU;AACV,0C;;;;;;;;;;;;ACnuCA;;AAEA;AACA;AACA,4CAA4C;;AAE5C,kE;;;;;;;;;;;;;ACNA;;AAEA;AACA;;AAEA,SAAS,YAAY;AACrB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,2FAA2F,gBAAgB;AAC3G;;AAEA;AACA,+FAA+F,gBAAgB;AAC/G,mGAAmG,gBAAgB;AACnH,mGAAmG,gBAAgB;AACnH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,qCAAqC,cAAc;;AAEnD;AACA,uDAAuD,8CAA8C;AACrG;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,KAAK;;;AAGL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA,YAAY;AACZ;;AAEA,qB;;;;;;;;;;;;AC9QA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,4B;;;;;;;;;;;;ACvCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wDAAwD,kBAAkB;AAC1E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mCAAmC,4BAA4B;AAC/D;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,+BAA+B,SAAS,gBAAgB,kBAAkB,cAAc;AACxF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,0BAA0B,6BAA6B;AACvD;AACA;;AAEA;AACA;AACA;;AAEA;AACA,sBAAsB,+BAA+B;AACrD;AACA;;AAEA;AACA;;AAEA;AACA;AACA,0BAA0B,2BAA2B;AACrD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB,8BAA8B;AACpD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B,8BAA8B;AAC5D;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,2BAA2B,mCAAmC;;AAE9D;AACA;;AAEA;AACA;AACA,yCAAyC,iBAAiB;AAC1D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT,4BAA4B,yBAAyB;AACrD;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,sBAAsB,0BAA0B;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,0BAA0B;AACpD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B,2BAA2B;AAC1D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2C;;;;;;;;;;;;AC9QA;;AAEA;;AAEA,uBAAuB,UAAU;;AAEjC;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+CAA+C,SAAS;AACxD;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,2BAA2B;;AAE3B;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iDAAiD,gBAAgB;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAOA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qDAAqD;;AAErD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wDAAwD,kBAAkB;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,wBAAwB,8BAA8B;AACtD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,uB;;;;;;;;;;;;ACzPA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,QAAQ,YAAY;AACpB,SAAS,OAAO;AAChB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yC;;;;;;;;;;;ACxDA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB;AAClB,8CAA8C,iCAAiC,OAAO,OAAO,6CAA6C,EAAE,WAAW;;AAEvJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,0CAA0C,WAAW;AACrD;AACA,iCAAiC;AACjC;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,2DAA2D,mCAAmC;AAC9F;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,WAAW;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,YAAY;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yDAAyD,mCAAmC;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA,uDAAuD,wCAAwC;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,mDAAmD,sCAAsC;AACzF;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mDAAmD,WAAW;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA,uDAAuD,wCAAwC;AAC/F;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,mDAAmD,sCAAsC;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,mCAAmC;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA,qDAAqD,YAAY;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,WAAW;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,mCAAmC;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,WAAW;AAClD;AACA;AACA;AACA;AACA;AACA,yCAAyC,YAAY;AACrD;AACA;AACA;AACA;AACA;AACA,0CAA0C,YAAY;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA6C,WAAW;AACxD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,mCAAmC;AACrG;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA6C,WAAW;AACxD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,yCAAyC,WAAW;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,mCAAmC;AACzE;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,kCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qCAAqC,qCAAqC;AAC1E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,mCAAmC;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,WAAW;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,YAAY;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,WAAW;AACX,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AAAA;AACL,GAAG,QAIH;;AAEA,CAAC;;;;;;;;;;;;ACrnCD;AACA,qBAAqB,cAAc,qBAAqB,SAAS,cAAc,YAAY,oBAAoB,qDAAqD,IAAI,wCAAwC,gCAAgC,MAAM,OAAO,eAAe,YAAY,eAAe,uCAAuC,mBAAmB,yBAAyB,KAAK;AAC/X,0FAA0F,KAAK,OAAO,0DAA0D,4BAA4B,gBAAgB,IAAI,gCAAgC,kBAAkB,mDAAmD,yBAAyB,6DAA6D,SAAS,mBAAmB,aAAa;AACpb,4BAA4B,wJAAwJ,UAAU,WAAW,4BAA4B,aAAa,yBAAyB,mDAAmD,qBAAqB,cAAc,oBAAoB,cAAc,kBAAkB,oBAAoB,cAAc,iBAAiB,oBAAoB,OAAO;AACne,GAAG,gBAAgB,gBAAgB,cAAc,gBAAgB,oBAAoB,cAAc,kDAAkD,qCAAqC,wBAAwB,cAAc,iBAAiB,sCAAsC;;;;;;;;;;;;ACJvR;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","if(typeof V3d === \"undefined\"){V3d = {};}if(typeof V3d.Navigation === \"undefined\")V3d.Navigation={};V3d.Navigation.NavCam =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./js/navcam/NavCam.js\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./js/navcam/AreaCam.js\":\n/*!******************************!*\\\n  !*** ./js/navcam/AreaCam.js ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nclass AreaCam {\r\n    constructor(params){\r\n\r\n        // OrthographicCamera( left, right, top, bottom, near, far )\r\n        this.camera = new THREE.OrthographicCamera();\r\n        this.camera.name = 'AreaCam_camera';\r\n\r\n        this.params = params || {};\r\n        if(this.params.resolution === undefined) this.params.resolution = new THREE.Vector2(64, 64);\r\n        if(this.params.growth === undefined) this.params.growth = 1;\r\n        if(this.params.wiggle === undefined) this.params.wiggle = .05;\r\n        if(this.params.overrideMaterial === undefined) this.params.overrideMaterial = AreaCam.defaultMaterial;\r\n        if(this.params.scene !== undefined) this.scene = this.params.scene;\r\n        console.log(this.params.resolution, this.scene, this.params.overrideMaterial);\r\n\r\n        this.renderer = new THREE.WebGLRenderer({\r\n            preserveDrawingBuffer:true\r\n        });\r\n        this.renderer.autoClear = false;\r\n        this.renderer.setSize(this.params.resolution.x, this.params.resolution.y);\r\n        this.renderer.setClearColor(new THREE.Color(0x000000), 1);\r\n\r\n        this.readFormat = THREE.RGBAFormat;\r\n        this.readBuffer = new Uint8Array(this.params.resolution.x * this.params.resolution.y * 4);\r\n        this.rtTexture = new THREE.WebGLRenderTarget(this.params.resolution.x, this.params.resolution.y, { \r\n                minFilter: THREE.NearestFilter, \r\n                magFilter: THREE.NearestFilter, \r\n                format: this.readFormat, \r\n                type: THREE.UnsignedByteType \r\n            }\r\n        );\r\n    }\r\n\r\n    get debugView(){\r\n        if(this._debugView === undefined) {\r\n            this._debugView = new THREE.Object3D();\r\n            this._debugView.name = 'AreaCam_debug';\r\n        }\r\n        return this._debugView;\r\n    }\r\n\r\n    SetRegion(left, right, top, bottom, low, high, direction, x, z){\r\n        if(left !== undefined) this.camera.left = left;\r\n        if(right !== undefined) this.camera.right = right;\r\n        if(top !== undefined) this.camera.top = top;\r\n        if(bottom !== undefined) this.camera.bottom = bottom;\r\n\r\n        if(this.camera.left !== undefined && this.camera.right !== undefined && this.camera.top !== undefined && this.camera.bottom !== undefined){\r\n            this.areaRatio = this.params.resolution.clone().divide(new THREE.Vector2(this.camera.right - this.camera.left, this.camera.top - this.camera.bottom));\r\n        }\r\n        \r\n        if(low !== undefined && high !== undefined){\r\n            this.low = low;\r\n            this.high = high;\r\n\r\n            this.camera.near = 0;\r\n            this.camera.far = this.high - this.low;\r\n        }\r\n\r\n        if(direction !== undefined){\r\n            this.direction = direction;\r\n            this.camera.position.copy(this.direction.clone().normalize().multiplyScalar(-this.high));\r\n            //this.camera.rotation.set(direction.x, direction.y, direction.z);\r\n            this.camera.rotation.copy(new THREE.Euler().setFromRotationMatrix(\r\n                new THREE.Matrix4().lookAt(this.camera.position, new THREE.Vector3(), new THREE.Vector3(0, 1, 0))\r\n            ));\r\n        }\r\n\r\n        if(x !== undefined) this.camera.position.x = x;\r\n        if(z !== undefined) this.camera.position.z = z;\r\n\r\n        this.camera.updateProjectionMatrix();\r\n\r\n        this.Snapshot();\r\n    }\r\n\r\n    Snapshot(){ \r\n        this.scene.overrideMaterial = this.params.overrideMaterial;\r\n        this.renderer.clearColor();\r\n        var rOffset = this.params.wiggle;\r\n        //console.log(\"Performance capabilities strategy selection\");\r\n        if(false){}\r\n        else if(false){ var ry, rx; }\r\n        else{ // high end\r\n            this.renderer.render(this.scene, this.camera, this.rtTexture, false);\r\n\r\n            var rx = this.camera.rotation.x;\r\n            var ry = this.camera.rotation.y;\r\n\r\n            this.camera.rotation.x = rx + rOffset;\r\n            this.renderer.render(this.scene, this.camera, this.rtTexture, false);\r\n            \r\n            this.camera.rotation.x = rx - rOffset;\r\n            this.renderer.render(this.scene, this.camera, this.rtTexture, false);\r\n\r\n            this.camera.rotation.x = rx;\r\n\r\n            this.camera.rotation.y = ry - rOffset;\r\n            this.renderer.render(this.scene, this.camera, this.rtTexture, false);\r\n\r\n            this.camera.rotation.y = ry + rOffset;\r\n            this.renderer.render(this.scene, this.camera, this.rtTexture, false);\r\n\r\n            this.camera.rotation.y = ry;\r\n        }\r\n        this.scene.overrideMaterial = null;\r\n        \r\n        this.renderer.readRenderTargetPixels(this.rtTexture, 0, 0, this.params.resolution.x, this.params.resolution.y, this.readBuffer);\r\n        \r\n        if(this.params.debug){\r\n            this.Helper(true);\r\n            this.DebugTexture(true);\r\n        }\r\n    }\r\n\r\n    CreateTextureFromBuffer(){\r\n        var texture = new THREE.DataTexture(this.readBuffer, this.params.resolution.x, this.params.resolution.y, this.readFormat);\r\n        texture.needsUpdate = true;\r\n        return texture;\r\n    }\r\n\r\n    Uint8ToGraph(graphArray){\r\n        var w = this.params.resolution.x,\r\n            h = this.params.resolution.y;\r\n        if(graphArray === undefined) graphArray = AreaCam.GraphArray(w, h);\r\n        graphArray = AreaCam.Uint8ToGraph(this.readBuffer, w, h, graphArray, this.params.growth);\r\n        return graphArray;\r\n    }\r\n\r\n    Helper(value){\r\n        if(value){\r\n            if(this._helper === undefined){\r\n                this._helper = new THREE.CameraHelper(this.camera);\r\n                this._helper.name = 'AreaCam_helper';\r\n                this.debugView.add(this._helper);\r\n            }\r\n            this._helper.visible = true;\r\n        }\r\n        else if(this._helper !== undefined){\r\n            this._helper.visible = false;\r\n        }\r\n    }\r\n\r\n    DebugTexture(value){\r\n        if(value){\r\n            if(this._debugTexture === undefined){\r\n                this._debugTexture = new THREE.Mesh(\r\n                    new THREE.BoxGeometry(this.camera.right - this.camera.left, .1, this.camera.top - this.camera.bottom)\r\n                );\r\n                this._debugTexture.name = 'AreaCam_debugTexture';\r\n                this.debugView.add(this._debugTexture);\r\n                this._debugTexture.position.set(0, 0, 20);\r\n            }\r\n            this._debugTexture.material.map = this.CreateTextureFromBuffer();\r\n            this._debugTexture.visible = true;\r\n        }\r\n        else if(this._debugTexture !== undefined){\r\n            this._debugTexture.visible = false;\r\n        }\r\n    }\r\n\r\n    static get defaultMaterial(){\r\n        if(this._defaultMaterial === undefined){\r\n            //var vertex = document.getElementById('vertexShader').textContent;\r\n            //var fragment = document.getElementById('fragmentShader').textContent;\r\n            var vertex = [\r\n                'void main() {',\r\n\t\t\t\t    'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n                '}'\r\n            ].join('\\n');\r\n            var fragment = [\r\n                'void main() {',\r\n\t\t\t\t    'gl_FragColor = vec4(1, 1, 1, 1.0);',\r\n                '}'\r\n            ].join('\\n');\r\n            this._defaultMaterial = new THREE.ShaderMaterial({\r\n                name: 'NavCam.AreaCam.defaultMaterial',\r\n                vertexShader: vertex,\r\n                fragmentShader: fragment,\r\n                side: THREE.DoubleSide,\r\n                depthWrite: false,\r\n                lights: false\r\n            });\r\n        }\r\n        return this._defaultMaterial;\r\n    }\r\n\r\n    static GraphArray(w, h){\r\n        var array = [];\r\n        for(var x = 0; x < w; x++){\r\n            var row = [];\r\n            array.push(row);\r\n            for(var y = 0; y < h; y++){\r\n                row.push(0);\r\n            }\r\n        }\r\n        return array;\r\n    }\r\n\r\n    static Uint8ToGraph(data, w, h, graphArray, growth){\r\n        var wLess = w - 1;\r\n        var hLess = h - 1;\r\n\r\n        for(var x = 1; x < wLess; x++){\r\n            for(var y = 1; y < hLess; y++){\r\n                if(false){ var dataIndex; }\r\n                else{\r\n                    // cross neighbours\r\n                    var valueCeil = 2;\r\n                    var any = (data[(y * w + x) * 4] > valueCeil);\r\n\r\n                    if(growth >= 1){\r\n                        any = any || ( \r\n                            (data[((y - 1) * w + x) * 4] > valueCeil)\r\n                            || (data[((y + 1) * w + x) * 4] > valueCeil)\r\n                            || (data[(y * w + x - 1) * 4] > valueCeil)\r\n                            || (data[(y * w + x + 1) * 4] > valueCeil)\r\n                        );\r\n                    }\r\n                    \r\n                    if(growth > 1){\r\n                        any = any || ( \r\n                            (data[((y - 2) * w + x) * 4] > valueCeil)\r\n                            || (data[((y + 2) * w + x) * 4] > valueCeil)\r\n                            || (data[(y * w + x - 2) * 4] > valueCeil)\r\n                            || (data[(y * w + x + 2) * 4] > valueCeil)\r\n                        );\r\n                    }\r\n\r\n                    if(growth > 2){\r\n                        any = any || ( \r\n                            (data[((y - 3) * w + x) * 4] > valueCeil)\r\n                            || (data[((y + 3) * w + x) * 4] > valueCeil)\r\n                            || (data[(y * w + x - 3) * 4] > valueCeil)\r\n                            || (data[(y * w + x + 3) * 4] > valueCeil)\r\n\r\n                            || (data[((y - 2) * w + x - 2) * 4] > valueCeil)\r\n                            || (data[((y - 2) * w + x + 2) * 4] > valueCeil)\r\n                            || (data[((y + 2) * w + x - 2) * 4] > valueCeil)\r\n                            || (data[((y + 2) * w + x + 2) * 4] > valueCeil)\r\n                        );\r\n                    }\r\n\r\n                    graphArray[x][y] = any ? 0 : 1;\r\n                }\r\n            }\r\n        }\r\n        return graphArray;\r\n    }\r\n\r\n    static MergeVertices(obj){\r\n        obj.traverse(function(child){\r\n            if(child instanceof THREE.Mesh){\r\n\t\t\t\tvar tempGeo = new THREE.Geometry().fromBufferGeometry(child.geometry);\r\n\t\t\t\ttempGeo.mergeVertices();\r\n\t\t\t\ttempGeo.computeVertexNormals();\r\n\t\t\t\ttempGeo.computeFaceNormals();\r\n\t\t\t\tchild.geometry = new THREE.BufferGeometry().fromGeometry(tempGeo);\r\n            }\r\n\t\t});\r\n    }\r\n}\r\n\r\nmodule.exports = AreaCam;\n\n/***/ }),\n\n/***/ \"./js/navcam/NavCam.js\":\n/*!*****************************!*\\\n  !*** ./js/navcam/NavCam.js ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\r\nconst AreaCam = __webpack_require__(/*! ./AreaCam */ \"./js/navcam/AreaCam.js\");\r\nconst Path = __webpack_require__(/*! ./Path */ \"./js/navcam/Path.js\");\r\n\r\nclass NavCam{\r\n\r\n    constructor(params){\r\n\r\n        this.areaCam = new AreaCam({\r\n            resolution: params.resolution,\r\n            growth: params.growth,\r\n            wiggle: params.wiggle,\r\n            overrideMaterial: params.overrideMaterial,\r\n            scene: params.scene,\r\n            debug: params.debug\r\n        });\r\n\r\n        this.pathfinder = new Path(this.areaCam, {\r\n            arcLengthDivisions: params.arcLengthDivisions,\r\n            smoothPath: params.smoothPath,\r\n            tryGetRange: params.tryGetRange,\r\n            debug: params.debug\r\n        });\r\n    }\r\n\r\n    Update(){\r\n\r\n        this.Snapshot();\r\n    }\r\n\r\n    Snapshot(){\r\n        if(this.areaCam.params.debug) this.areaCam.debugView.visible = false;\r\n        if(this.pathfinder.params.debug) this.pathfinder.debugView.visible = false;\r\n        // Render with override material\r\n        this.areaCam.Snapshot();\r\n\r\n        if(this.areaCam.params.debug) this.areaCam.debugView.visible = true;\r\n        if(this.pathfinder.params.debug) this.pathfinder.debugView.visible = true;\r\n        \r\n        // [0, 1] walkable/wall array\r\n        this.graphArray = this.areaCam.Uint8ToGraph(this.graphArray);\r\n    }\r\n\r\n    Solve(worldStart, worldEnd, inserts){\r\n        this.Snapshot();\r\n        var worldPath = this.pathfinder.Solve(worldStart, worldEnd, this.graphArray, inserts);\r\n        return worldPath;\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = NavCam;\r\nmodule.exports.AreaCam = AreaCam;\r\nmodule.exports.Path = Path;\n\n/***/ }),\n\n/***/ \"./js/navcam/Path.js\":\n/*!***************************!*\\\n  !*** ./js/navcam/Path.js ***!\n  \\***************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\r\nconst astar = __webpack_require__(/*! ./lib/astar */ \"./js/navcam/lib/astar.js\");\r\nconst simplify = __webpack_require__(/*! ./lib/simplify */ \"./js/navcam/lib/simplify.js\");\r\n\r\nvar _gridResult, _graph, _graphStart, _options;\r\n\r\nclass Path{\r\n    constructor(areaCam, params){\r\n        this.areaCam = areaCam;\r\n\r\n        this.params = params || {debug:false};\r\n        if(this.params.arcLengthDivisions === undefined) this.params.arcLengthDivisions = 100;\r\n        if(this.params.smoothPath === undefined) this.params.smoothPath = 2;\r\n        if(this.params.tryGetRange === undefined) this.params.tryGetRange = 0;\r\n    }\r\n\r\n    get debugView(){\r\n        if(this._debugView === undefined) {\r\n            this._debugView = new THREE.Object3D();\r\n            this._debugView.name = 'NavPath_debug';\r\n        }\r\n        return this._debugView;\r\n    }\r\n\r\n    ToGrid(world){\r\n        var cam = this.areaCam.camera;\r\n        var toCamX = cam.position.x - world.x,\r\n            toCamY = cam.position.z - world.z;\r\n        var gridX = (toCamX - cam.left) * this.areaCam.areaRatio.x,\r\n            gridY = (toCamY - cam.bottom) * this.areaCam.areaRatio.y;\r\n        gridX = THREE.Math.clamp(this.areaCam.params.resolution.x - Math.floor(gridX + .001), 0, this.areaCam.params.resolution.x - 1);\r\n        gridY = THREE.Math.clamp(Math.floor(gridY + .001), 0, this.areaCam.params.resolution.y - 1);\r\n        return new THREE.Vector2(gridX, gridY);\r\n    }\r\n\r\n    ToWorld(grid){\r\n        var cam = this.areaCam.camera;\r\n        var toCamX = grid.x / this.areaCam.areaRatio.x + cam.left;\r\n        var toCamY = (this.areaCam.params.resolution.y - grid.y) / this.areaCam.areaRatio.y + cam.bottom;\r\n        var worldX = toCamX + cam.position.x;\r\n        var worldZ = toCamY + cam.position.z;\r\n        return new THREE.Vector3(worldX, 0, worldZ);\r\n    }\r\n\r\n    Simplify(points, tolerance){\r\n        if(tolerance === undefined) tolerance = 2.;\r\n        var highQuality = true;\r\n        var simplified = simplify(points, tolerance, highQuality);\r\n\r\n        if(this.params.debug){\r\n            //console.log('\\tSimplified path:', points);\r\n        }\r\n\r\n        // Raycast check clear from point to point, remove unecessary points\r\n\r\n        return simplified;\r\n    }\r\n\r\n    ToWorldResult(result){\r\n        var worldResult = [];\r\n\r\n        for(var i = 0, numResults = result.length; i < numResults; i++){\r\n            var worldPos = this.ToWorld(result[i]);\r\n            worldResult[i] = worldPos;\r\n        }\r\n\r\n        return worldResult;\r\n    }\r\n\r\n    Closest(graph, pt, testNode){\r\n        var grid = graph.grid;\r\n        var w = grid.length;\r\n        if(w < 3 || grid[0].length < 3) return undefined;\r\n        var h = grid[0].length;\r\n\r\n        var x = THREE.Math.clamp(pt.x, 0, w - 1);\r\n        var y = THREE.Math.clamp(pt.y, 0, h - 1);\r\n\r\n        if(testNode(grid[x][y])) return grid[x][y];\r\n\r\n        for(var iExpand = 1, numExpand = this.params.tryGetRange; iExpand < numExpand; iExpand++){\r\n            var left = THREE.Math.clamp(x - iExpand, 0, w - 1),\r\n                right = THREE.Math.clamp(x + iExpand + 1, left, w - 1),\r\n                bottom = THREE.Math.clamp(y - iExpand, 0, h - 1),\r\n                top = THREE.Math.clamp(y + iExpand + 1, bottom, h - 1);\r\n            for(var iX = left; iX < right; iX ++){\r\n                var skipY = iX === left || iX === right ? 1 : THREE.Math.clamp(top - bottom - 2, 1, iExpand * 2);\r\n                for(var iY = bottom; iY < top; iY += skipY){\r\n                    if(testNode(grid[iX][iY])){\r\n                        return grid[iX][iY];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    _ClosestDefaultTest(node){\r\n        return !node.isWall()\r\n    }\r\n\r\n    _ClosestSearchTest(node){\r\n        var notWall = !node.isWall();\r\n        if(notWall) _gridResult = astar.search(_graph, _graphStart, node, _options);\r\n        return _gridResult !== undefined && _gridResult.length > 1;\r\n    }\r\n\r\n    Search(graph, start, end, options){\r\n\r\n        var graphStart = this.Closest(graph, start, this._ClosestDefaultTest);\r\n        if(graphStart !== undefined){\r\n            _gridResult = undefined;\r\n            _graph = graph;\r\n            _graphStart = graphStart;\r\n            _options = options;\r\n            if(this.params.tryGetRange > 0){\r\n                this.Closest(graph, end, this._ClosestSearchTest);\r\n            }\r\n            else{\r\n                var graphEnd = this.Closest(graph, end, this._ClosestDefaultTest);\r\n                if(graphEnd !== undefined) _gridResult = astar.search(_graph, _graphStart, graphEnd, _options);\r\n            }\r\n\r\n            if(_gridResult !== undefined && _gridResult.length > 1) return _gridResult;\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    Solve(worldStart, worldEnd, graphArray, inserts){\r\n        if(graphArray !== undefined) this.graph = new astar.Graph(graphArray, {diagonal:true});\r\n\r\n        var start = this.ToGrid(worldStart),\r\n            end = this.ToGrid(worldEnd);\r\n\r\n        var gridResult = this.Search(this.graph, start, end, {heuristic:astar.heuristics.euclideanPreferStraight, diagonalWeight:1.3});\r\n        if(gridResult !== undefined){\r\n            var worldY = (worldStart.y + worldEnd.y) * .5;\r\n            var worldResult = this.ToWorldResult(this.Simplify(gridResult, this.params.smoothPath), worldY);\r\n            \r\n            // inserts\r\n            if(inserts !== undefined){\r\n                for(var i = 0; i < inserts.length; i++){\r\n                    var insert = inserts[i];\r\n                    insert.position.y = 0;\r\n                    worldResult.splice(insert.index, 0, insert.position);\r\n                }\r\n            }\r\n\r\n            // interpolate y\r\n            var dy = worldEnd.y - worldStart.y;\r\n            for(var i = 0, numResults = worldResult.length; i < numResults; i++) worldResult[i].y = worldStart.y + dy * (i / numResults);\r\n            if(worldResult !== undefined && worldResult.length > 1){\r\n                worldResult[0] = worldStart;\r\n                this.UpdateCurve(worldResult);\r\n                \r\n                if(this.params.debug){\r\n                    var gridTexture = this.CreateTextureFromGrid(graphArray, start, end, gridResult);\r\n                    this.DebugTexture(gridTexture);\r\n                }\r\n\r\n                return this.curve;\r\n            }\r\n        }\r\n\r\n        if(this.curve !== undefined) this.UpdateCurve();\r\n        return undefined;\r\n    }\r\n\r\n    UpdateCurve(positions){\r\n        \r\n        if(this.curve === undefined){\r\n            this.curve = new THREE.CatmullRomCurve3(positions);\r\n            this.curve.arcLengthDivisions = this.params.arcLengthDivisions;\r\n            this.curve.type = 'centripetal';\r\n            this.curve.tension = .5;\r\n\r\n            this._tempCurvePoint = new THREE.Vector3();\r\n\r\n            if(this.params.debug){\r\n                var geometry = new THREE.Geometry();\r\n                for (var i = 0; i < this.curve.arcLengthDivisions; i++){\r\n                    geometry.vertices.push(new THREE.Vector3());\r\n                }\r\n            \r\n                this.curve.mesh = new THREE.Line(geometry, \r\n                    new THREE.LineBasicMaterial({\r\n                        color: 0x0000ff,\r\n                        linewidth: 10\r\n                    })\r\n                );\r\n                this.curve.mesh.name = 'NavPath_path';\r\n\r\n                this.debugView.add(this.curve.mesh);\r\n            }\r\n        }\r\n\r\n        if(positions === undefined){\r\n            if(this._clearCurvePositions === undefined) this._clearCurvePositions = [new THREE.Vector3(), new THREE.Vector3()];\r\n            this.curve.points = this._clearCurvePositions;\r\n        }\r\n        else{\r\n            this.curve.points = positions;\r\n        }\r\n        this.curve.needsUpdate = true;\r\n\r\n        if(this.params.debug && this.curve !== undefined){\r\n            var divisions = this.curve.arcLengthDivisions;\r\n            for (var i = 0; i < divisions; i ++){\r\n                var p = this.curve.mesh.geometry.vertices[i];\r\n                p.copy(this.curve.getPoint(i / (divisions - 1)));\r\n            }\r\n            this.curve.mesh.geometry.verticesNeedUpdate = true;\r\n        }\r\n    }\r\n\r\n    GetAt(time){\r\n        if(this.curve !== undefined){\r\n            time = THREE.Math.clamp(time > 1 ? time % 1 : time, 0, 1);\r\n            var point = this.curve.getPoint(time, this._tempCurvePoint);\r\n            return point !== undefined ? point : undefined;\r\n        }\r\n    }\r\n\r\n    CreateTextureFromGrid(grid, start, end, path){\r\n        var w = this.areaCam.params.resolution.x,\r\n            h = this.areaCam.params.resolution.y;\r\n        var readBuffer = new Uint8Array(w * h * 4);\r\n        for(var x = 0; x < w; x++){\r\n            for(var y = 0; y < h; y++){\r\n                var index = (y * w + x) * 4;\r\n                var on = readBuffer[index] = grid[x][y] * 255;\r\n                readBuffer[index + 1] = on;\r\n                readBuffer[index + 2] = on;\r\n\r\n                readBuffer[index + 3] = 255;\r\n            }\r\n        }\r\n\r\n        var setPoint = function(v, r, g, b){\r\n            var index = (v.y * w + v.x) * 4;\r\n            readBuffer[index] = r;\r\n            readBuffer[index + 1] = g;\r\n            readBuffer[index + 2] = b;\r\n        };\r\n\r\n        for(var iPath = 0, numPath = path.length; iPath < numPath; iPath++){\r\n            setPoint(path[iPath], 0, 255, 255);\r\n        }\r\n\r\n        setPoint(start, 100, 255, 100);\r\n        setPoint(end, 100, 100, 255);\r\n\r\n        var texture = new THREE.DataTexture(readBuffer, w, h, THREE.RGBAFormat);\r\n        texture.needsUpdate = true;\r\n        return texture;\r\n    }\r\n\r\n    DebugTexture(map){\r\n        if(map){\r\n            if(this._debugTexture === undefined){\r\n                var cam = this.areaCam.camera;\r\n                this._debugTexture = new THREE.Mesh(\r\n                    new THREE.BoxGeometry(cam.right - cam.left, .1, cam.top - cam.bottom)\r\n                );\r\n                this._debugTexture.name = 'NavPath_debugTexture';\r\n                this.debugView.add(this._debugTexture);\r\n                this._debugTexture.position.set(-20, 0, 20);\r\n            }\r\n            this._debugTexture.material.map = map;\r\n            this._debugTexture.visible = true;\r\n        }\r\n        else if(this._debugTexture !== undefined){\r\n            this._debugTexture.visible = false;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Path;\n\n/***/ }),\n\n/***/ \"./js/navcam/lib/astar.js\":\n/*!********************************!*\\\n  !*** ./js/navcam/lib/astar.js ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// javascript-astar 0.4.1\n// http://github.com/bgrins/javascript-astar\n// Freely distributable under the MIT License.\n// Implements the astar search algorithm in javascript using a Binary Heap.\n// Includes Binary Heap (with modifications) from Marijn Haverbeke.\n// http://eloquentjavascript.net/appendix2.html\n\nfunction pathTo(node) {\n  var curr = node;\n  var path = [];\n  while (curr.parent) {\n    path.unshift(curr);\n    curr = curr.parent;\n  }\n  return path;\n}\n\nfunction getHeap() {\n  return new BinaryHeap(function(node) {\n    return node.f;\n  });\n}\n\nvar astar = {\n  /**\n  * Perform an A* Search on a graph given a start and end node.\n  * @param {Graph} graph\n  * @param {GridNode} start\n  * @param {GridNode} end\n  * @param {Object} [options]\n  * @param {bool} [options.closest] Specifies whether to return the\n             path to the closest node if the target is unreachable.\n  * @param {Function} [options.heuristic] Heuristic function (see\n  *          astar.heuristics).\n  */\n  search: function(graph, start, end, options) {\n    graph.cleanDirty();\n    options = options || {};\n    var heuristic = options.heuristic || astar.heuristics.manhattan;\n    var diagonalWeight = options.diagonalWeight || 1.41421;\n    var closest = options.closest || false;\n\n    var openHeap = getHeap(),\n        closestNode = start; // set the start node to be the closest if required\n    var closedList = [];\n    start.h = heuristic(start, end, start);\n\n    openHeap.push(start);\n\n    while(openHeap.size() > 0) {\n\n        // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n        var currentNode = openHeap.pop();\n\n        // End case -- result has been found, return the traced path.\n        if(currentNode === end) {\n            while(closedList.length>0)closedList.pop().closed = false;\n            return pathTo(currentNode);\n        }\n\n        // Normal case -- move currentNode from open to closed, process each of its neighbors.\n        currentNode.closed = true;\n        closedList.push(currentNode);\n\n        // Find all neighbors for the current node.\n        var neighbors = graph.neighbors(currentNode);\n\n        for (var i = 0, il = neighbors.length; i < il; ++i) {\n            var neighbor = neighbors[i];\n\n            if (neighbor.closed || neighbor.isWall()) {\n                // Not a valid node to process, skip to next neighbor.\n                continue;\n            }\n\n            // The g score is the shortest distance from start to current node.\n            // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n            var gScore = currentNode.g + neighbor.getCost(currentNode, diagonalWeight),\n                beenVisited = neighbor.visited;\n\n            if (!beenVisited || gScore < neighbor.g) {\n\n                // Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n                neighbor.visited = true;\n                neighbor.parent = currentNode;\n                neighbor.h = neighbor.h || heuristic(neighbor, end, currentNode);\n                neighbor.g = gScore;\n                neighbor.f = neighbor.g + neighbor.h;\n                graph.markDirty(neighbor);\n                if (closest) {\n                    // If the neighbour is closer than the current closestNode or if it's equally close but has\n                    // a cheaper path than the current closest node then it becomes the closest node\n                    if (neighbor.h < closestNode.h || (neighbor.h === closestNode.h && neighbor.g < closestNode.g)) {\n                        closestNode = neighbor;\n                    }\n                }\n\n                if (!beenVisited) {\n                    // Pushing to heap will put it in proper place based on the 'f' value.\n                    openHeap.push(neighbor);\n                }\n                else {\n                    // Already seen the node, but since it has been rescored we need to reorder it in the heap\n                    openHeap.rescoreElement(neighbor);\n                }\n            }\n        }\n    }\n    while(closedList.length>0)closedList.pop().closed = false;\n\n    if (closest) {\n        return pathTo(closestNode);\n    }\n\n    // No result was found - empty array signifies failure to find path.\n    return [];\n  },\n  // See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\n  heuristics: {\n      manhattan: function(pos0, pos1) {\n          var d1 = Math.abs(pos1.x - pos0.x);\n          var d2 = Math.abs(pos1.y - pos0.y);\n          return d1 + d2;\n      },\n      diagonal: function(pos0, pos1) {\n          var D = 1;\n          var D2 = Math.sqrt(2);\n          var d1 = Math.abs(pos1.x - pos0.x);\n          var d2 = Math.abs(pos1.y - pos0.y);\n          return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2));\n      },\n      euclidean: function(pos0, pos1) {\n        var dx = pos1.x - pos0.x,\n          dy = pos1.y - pos0.y;\n        return Math.sqrt(dx * dx + dy * dy);\n      },\n      euclideanPreferStraight: function(pos0, pos1, current){\n        var dx2 = pos0.x - pos1.x,\n            dy2 = pos0.y - pos1.y;\n\n        var dx1 = current.x - pos1.x,\n            dy1 = current.y - pos1.y;\n\n        var cross = Math.abs(dx1 * dy2 - dx2 * dy1)\n        var heuristic = Math.sqrt(dx2 * dx2 + dy2 * dy2);\n        return heuristic + cross * 0.01;\n      }\n  },\n  cleanNode:function(node){\n      node.f = 0;\n      node.g = 0;\n      node.h = 0;\n      node.visited = false;\n      node.closed = false;\n      node.parent = null;\n  }\n};\n\n/**\n * A graph memory structure\n * @param {Array} gridIn 2D array of input weights\n * @param {Object} [options]\n * @param {bool} [options.diagonal] Specifies whether diagonal moves are allowed\n */\nfunction Graph(gridIn, options) {\n  options = options || {};\n  this.nodes = [];\n  this.diagonal = !!options.diagonal;\n  this.grid = [];\n  for (var x = 0; x < gridIn.length; x++) {\n    this.grid[x] = [];\n\n    for (var y = 0, row = gridIn[x]; y < row.length; y++) {\n      var node = new GridNode(x, y, row[y]);\n      this.grid[x][y] = node;\n      this.nodes.push(node);\n    }\n  }\n  this.init();\n}\n\nGraph.prototype.init = function() {\n  this.dirtyNodes = [];\n  for (var i = 0; i < this.nodes.length; i++) {\n    astar.cleanNode(this.nodes[i]);\n  }\n};\n\nGraph.prototype.cleanDirty = function() {\n  for (var i = 0; i < this.dirtyNodes.length; i++) {\n    astar.cleanNode(this.dirtyNodes[i]);\n  }\n  this.dirtyNodes = [];\n};\n\nGraph.prototype.markDirty = function(node) {\n  this.dirtyNodes.push(node);\n};\n\nGraph.prototype.neighbors = function(node) {\n  var ret = [];\n  var x = node.x;\n  var y = node.y;\n  var grid = this.grid;\n\n  // West\n  if (grid[x - 1] && grid[x - 1][y]) {\n    ret.push(grid[x - 1][y]);\n  }\n\n  // East\n  if (grid[x + 1] && grid[x + 1][y]) {\n    ret.push(grid[x + 1][y]);\n  }\n\n  // South\n  if (grid[x] && grid[x][y - 1]) {\n    ret.push(grid[x][y - 1]);\n  }\n\n  // North\n  if (grid[x] && grid[x][y + 1]) {\n    ret.push(grid[x][y + 1]);\n  }\n\n  if (this.diagonal) {\n    // Southwest\n    if (grid[x - 1] && grid[x - 1][y - 1]) {\n      ret.push(grid[x - 1][y - 1]);\n    }\n\n    // Southeast\n    if (grid[x + 1] && grid[x + 1][y - 1]) {\n      ret.push(grid[x + 1][y - 1]);\n    }\n\n    // Northwest\n    if (grid[x - 1] && grid[x - 1][y + 1]) {\n      ret.push(grid[x - 1][y + 1]);\n    }\n\n    // Northeast\n    if (grid[x + 1] && grid[x + 1][y + 1]) {\n      ret.push(grid[x + 1][y + 1]);\n    }\n  }\n\n  return ret;\n};\n\nGraph.prototype.toString = function() {\n  var graphString = [];\n  var nodes = this.grid;\n  for (var x = 0; x < nodes.length; x++) {\n    var rowDebug = [];\n    var row = nodes[x];\n    for (var y = 0; y < row.length; y++) {\n      rowDebug.push(row[y].weight);\n    }\n    graphString.push(rowDebug.join(\" \"));\n  }\n  return graphString.join(\"\\n\");\n};\n\nfunction GridNode(x, y, weight) {\n  this.x = x;\n  this.y = y;\n  this.weight = weight;\n}\n\nGridNode.prototype.toString = function() {\n  return \"[\" + this.x + \" \" + this.y + \"]\";\n};\n\nGridNode.prototype.getCost = function(fromNeighbor, diagonalWeight) {\n  // Take diagonal weight into consideration.\n  if (fromNeighbor && fromNeighbor.x != this.x && fromNeighbor.y != this.y) {\n    return this.weight * diagonalWeight;\n  }\n  return this.weight;\n};\n\nGridNode.prototype.isWall = function() {\n  return this.weight === 0;\n};\n\nfunction BinaryHeap(scoreFunction) {\n  this.content = [];\n  this.scoreFunction = scoreFunction;\n}\n\nBinaryHeap.prototype = {\n  push: function(element) {\n    // Add the new element to the end of the array.\n    this.content.push(element);\n\n    // Allow it to sink down.\n    this.sinkDown(this.content.length - 1);\n  },\n  pop: function() {\n    // Store the first element so we can return it later.\n    var result = this.content[0];\n    // Get the element at the end of the array.\n    var end = this.content.pop();\n    // If there are any elements left, put the end element at the\n    // start, and let it bubble up.\n    if (this.content.length > 0) {\n      this.content[0] = end;\n      this.bubbleUp(0);\n    }\n    return result;\n  },\n  remove: function(node) {\n    var i = this.content.indexOf(node);\n\n    // When it is found, the process seen in 'pop' is repeated\n    // to fill up the hole.\n    var end = this.content.pop();\n\n    if (i !== this.content.length - 1) {\n      this.content[i] = end;\n\n      if (this.scoreFunction(end) < this.scoreFunction(node)) {\n        this.sinkDown(i);\n      } else {\n        this.bubbleUp(i);\n      }\n    }\n  },\n  size: function() {\n    return this.content.length;\n  },\n  rescoreElement: function(node) {\n    this.sinkDown(this.content.indexOf(node));\n  },\n  sinkDown: function(n) {\n    // Fetch the element that has to be sunk.\n    var element = this.content[n];\n\n    // When at 0, an element can not sink any further.\n    while (n > 0) {\n\n      // Compute the parent element's index, and fetch it.\n      var parentN = ((n + 1) >> 1) - 1;\n      var parent = this.content[parentN];\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[parentN] = element;\n        this.content[n] = parent;\n        // Update 'n' to continue at the new position.\n        n = parentN;\n      }\n      // Found a parent that is less, no need to sink any further.\n      else {\n        break;\n      }\n    }\n  },\n  bubbleUp: function(n) {\n    // Look up the target element and its score.\n    var length = this.content.length;\n    var element = this.content[n];\n    var elemScore = this.scoreFunction(element);\n\n    while (true) {\n      // Compute the indices of the child elements.\n      var child2N = (n + 1) << 1;\n      var child1N = child2N - 1;\n      // This is used to store the new position of the element, if any.\n      var swap = null;\n      var child1Score;\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        var child1 = this.content[child1N];\n        child1Score = this.scoreFunction(child1);\n\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) {\n          swap = child1N;\n        }\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        var child2 = this.content[child2N];\n        var child2Score = this.scoreFunction(child2);\n        if (child2Score < (swap === null ? elemScore : child1Score)) {\n          swap = child2N;\n        }\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap !== null) {\n        this.content[n] = this.content[swap];\n        this.content[swap] = element;\n        n = swap;\n      }\n      // Otherwise, we are done.\n      else {\n        break;\n      }\n    }\n  }\n};\n\nmodule.exports = astar;\nmodule.exports.Graph = Graph;\n\n/***/ }),\n\n/***/ \"./js/navcam/lib/simplify.js\":\n/*!***********************************!*\\\n  !*** ./js/navcam/lib/simplify.js ***!\n  \\***********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_RESULT__;/*\n (c) 2017, Vladimir Agafonkin\n Simplify.js, a high-performance JS polyline simplification library\n mourner.github.io/simplify-js\n*/\n\n(function () { 'use strict';\n\n// to suit your point format, run search/replace for '.x' and '.y';\n// for 3D version, see 3d branch (configurability would draw significant performance overhead)\n\n// square distance between 2 points\nfunction getSqDist(p1, p2) {\n\n    var dx = p1.x - p2.x,\n        dy = p1.y - p2.y;\n\n    return dx * dx + dy * dy;\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(p, p1, p2) {\n\n    var x = p1.x,\n        y = p1.y,\n        dx = p2.x - x,\n        dy = p2.y - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = p2.x;\n            y = p2.y;\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = p.x - x;\n    dy = p.y - y;\n\n    return dx * dx + dy * dy;\n}\n// rest of the code doesn't care about point format\n\n// basic distance-based simplification\nfunction simplifyRadialDist(points, sqTolerance) {\n\n    var prevPoint = points[0],\n        newPoints = [prevPoint],\n        point;\n\n    for (var i = 1, len = points.length; i < len; i++) {\n        point = points[i];\n\n        if (getSqDist(point, prevPoint) > sqTolerance) {\n            newPoints.push(point);\n            prevPoint = point;\n        }\n    }\n\n    if (prevPoint !== point) newPoints.push(point);\n\n    return newPoints;\n}\n\nfunction simplifyDPStep(points, first, last, sqTolerance, simplified) {\n    var maxSqDist = sqTolerance,\n        index;\n\n    for (var i = first + 1; i < last; i++) {\n        var sqDist = getSqSegDist(points[i], points[first], points[last]);\n\n        if (sqDist > maxSqDist) {\n            index = i;\n            maxSqDist = sqDist;\n        }\n    }\n\n    if (maxSqDist > sqTolerance) {\n        if (index - first > 1) simplifyDPStep(points, first, index, sqTolerance, simplified);\n        simplified.push(points[index]);\n        if (last - index > 1) simplifyDPStep(points, index, last, sqTolerance, simplified);\n    }\n}\n\n// simplification using Ramer-Douglas-Peucker algorithm\nfunction simplifyDouglasPeucker(points, sqTolerance) {\n    var last = points.length - 1;\n\n    var simplified = [points[0]];\n    simplifyDPStep(points, 0, last, sqTolerance, simplified);\n    simplified.push(points[last]);\n\n    return simplified;\n}\n\n// both algorithms combined for awesome performance\nfunction simplify(points, tolerance, highestQuality) {\n\n    if (points.length <= 2) return points;\n\n    var sqTolerance = tolerance !== undefined ? tolerance * tolerance : 1;\n\n    points = highestQuality ? points : simplifyRadialDist(points, sqTolerance);\n    points = simplifyDouglasPeucker(points, sqTolerance);\n\n    return points;\n}\n\n// export as AMD module / Node module / browser or worker variable\nif (true) !(__WEBPACK_AMD_DEFINE_RESULT__ = (function() { return simplify; }).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\nelse {}\n\n})();\n\n\n/***/ })\n\n/******/ });\n//# sourceMappingURL=V3d.Navigation.js.map","\r\n// npx webpack-cli ./index.js --output ./bundle.js --mode development\r\n\r\n/*require('./js/lib/three/three');\r\nrequire('./js/lib/three/controls/OrbitControls');\r\nrequire('./js/lib/three/loaders/OBJLoader');*/\r\n\r\nglobal.App = require('./js/App')();","\r\nconst Stats = require('./lib/stats.min');\r\n\r\nconst Scene = require('./Scene');\r\nvar input = require('./Input');\r\n\r\n//V3d = {Navigation:{NavCam:(require('./navcam/NavCam'))}};\r\nrequire('../V3d.Navigation');\r\n\r\nfunction ViewportToWorldPlane(viewportPoint, camera){\r\n    // Ref: WestLangley https://stackoverflow.com/questions/13055214/mouse-canvas-x-y-to-three-js-world-x-y-z\r\n    //var vector = new THREE.Vector3();\r\n    /*vector.set(\r\n        ( event.clientX / window.innerWidth ) * 2 - 1,\r\n        - ( event.clientY / window.innerHeight ) * 2 + 1,\r\n        0.5 );*/\r\n    /*viewportPoint.x = viewportPoint.x * 2 - 1;\r\n    viewportPoint.y = -viewportPoint.y * 2 + 1;*/\r\n    viewportPoint = viewportPoint.clone();\r\n    viewportPoint.z = 0.5;\r\n    viewportPoint.unproject(camera);\r\n    var dir = viewportPoint.sub(camera.position).normalize();\r\n    var distance = -camera.position.y / dir.y;\r\n    var worldPos = camera.position.clone().add(dir.multiplyScalar(distance));\r\n    return worldPos;\r\n}\r\n\r\nfunction SceneSetup(){\r\n    var container = document.getElementById(\"viewerGL\");\r\n    scene = new Scene();\r\n\r\n    scene.Init(container);\r\n\r\n    scene.DefaultLights();\r\n\r\n    input.Init(scene.camera, container);\r\n    input.onResize.push(scene.ReconfigureViewport.bind(scene));\r\n    container.appendChild(scene.renderer.domElement);\r\n\r\n    // Camera move\r\n    //scene.camera.position.x += 60 * Scene.units;\r\n    scene.camera.position.y += 150 * Scene.units;\r\n    //scene.camera.position.z += 50 * Scene.units;\r\n\r\n    if (options.debug == true) {\r\n        stats = new Stats();\r\n        container.appendChild(stats.dom);\r\n        stats.dom.style.margin = '20px';\r\n    }\r\n\r\n    Update();\r\n}\r\n\r\nvar navCam;\r\nvar scene, options;\r\nvar helper, stats;\r\n\r\nfunction Update(){\r\n    requestAnimationFrame(Update);\r\n\r\n    input.Update();\r\n    scene.Update();\r\n\r\n    if(stats !== undefined){\r\n        stats.update();\r\n    }\r\n}\r\n\r\nfunction Run(){\r\n    options = {\r\n        debug: true\r\n    };\r\n\r\n    SceneSetup();\r\n    input.keyboard.on('control', function(){\r\n        scene.Render();\r\n    });\r\n\r\n    scene.camera.controller.controls.target.set(-40, 10, 20);\r\n\r\n    // Grid\r\n    var gridHelper = new THREE.GridHelper(200 * Scene.units, 200, 0x606060, 0x000000);\r\n    gridHelper.material.transparent = true;\r\n    gridHelper.material.opacity = .2;\r\n\tgridHelper.position.set(0, -1, 0);\r\n\tscene.AddDefault(gridHelper);\r\n\r\n\t// Ground helper\r\n\thelper = new THREE.AxisHelper(5);\r\n    scene.Add(helper);\r\n    \r\n    // Viz sphere\r\n    var sphere = new THREE.Mesh(new THREE.SphereGeometry(.5), new THREE.MeshBasicMaterial({color: 0x000000}));\r\n    scene.Add(sphere);\r\n\r\n    // Dynamic viz\r\n    var cubeLow = new THREE.Mesh(new THREE.CubeGeometry(2, 4, 1), new THREE.MeshBasicMaterial({color: 0x000000}));\r\n    var cubeCenter1 = new THREE.Mesh(new THREE.CubeGeometry(2, 5, 1), new THREE.MeshBasicMaterial({color: 0xff0000}));\r\n    var cubeCenter2 = new THREE.Mesh(new THREE.CubeGeometry(1, 5, 2), new THREE.MeshBasicMaterial({color: 0xff0000}));\r\n    scene.Add(cubeLow);\r\n    scene.Add(cubeCenter1);\r\n    scene.Add(cubeCenter2);\r\n    cubeLow.position.y = 0;\r\n    cubeCenter1.position.y = 4;\r\n    cubeCenter2.position.y = 6;\r\n\r\n    cubeLow.position.z = 20;\r\n    cubeCenter1.position.z = 20;\r\n    cubeCenter2.position.x = 20;\r\n\r\n    var obstaclesClock = new THREE.Clock();\r\n    obstaclesClock.start();\r\n    var obstacles = function(){\r\n        var t = obstaclesClock.getElapsedTime();\r\n        var speed = .5;\r\n        cubeLow.position.x = 20 + Math.sin(t * speed) * 8;\r\n        cubeCenter1.position.x = 20 + Math.sin(t * speed + 2) * 8;\r\n        cubeCenter2.position.z = 20 + Math.cos(t * speed + 1) * 8;\r\n    };\r\n\r\n    input.Repeat(obstacles, 45);\r\n\r\n    // View camera\r\n\r\n    var viewCamera = new THREE.PerspectiveCamera(45, 1, .1, 100 * Scene.units);\r\n    var view = {\r\n        left: 0.0,\r\n\t\ttop: 0.7,\r\n\t\twidth: 0.3,\r\n        height: 0.3,\r\n        background: 0xffffff\r\n    };\r\n    window.viewCamera = viewCamera;\r\n    var updateViewCamera = function(position, lookAt){\r\n\r\n        var clearColor = scene.renderer.getClearColor().getHex();\r\n\r\n        var left   = Math.floor( input.screen.width  * view.left );\r\n        var top    = Math.floor( input.screen.height * view.top );\r\n        var width  = Math.floor( input.screen.width  * view.width );\r\n        var height = Math.floor( input.screen.height * view.height );\r\n\r\n        scene.renderer.setViewport( left, top, width, height );\r\n        scene.renderer.setScissor( left, top, width, height );\r\n        scene.renderer.setScissorTest( true );\r\n        scene.renderer.setClearColor( view.background );\r\n\r\n        viewCamera.position.copy(position);\r\n        viewCamera.lookAt(lookAt);\r\n        viewCamera.aspect = width / height;\r\n        viewCamera.updateProjectionMatrix();\r\n\r\n        var opacity = modelMaterial.opacity;\r\n        modelMaterial.opacity = 1;\r\n        scene.renderer.render( scene.scene, viewCamera );\r\n        modelMaterial.opacity = opacity;\r\n\r\n        var left   = 0;\r\n        var top    = 0;\r\n        var width  = Math.floor( input.screen.width );\r\n        var height = Math.floor( input.screen.height );\r\n\r\n        scene.renderer.setViewport( left, top, width, height );\r\n        scene.renderer.setScissor( left, top, width, height );\r\n        scene.renderer.setClearColor( clearColor );\r\n    };\r\n\r\n    var postRender = function(){};\r\n    scene.postRender.push(function(){postRender();});\r\n\r\n    // Assets\r\n    var modelMaterial = new THREE.MeshLambertMaterial({color:0x909090, transparent:true, opacity:0.6});\r\n    var objLoader = new THREE.OBJLoader();\r\n\tobjLoader.load('assets/Room.obj', function (obj){\r\n        obj.traverse(function(child){\r\n            if(child instanceof THREE.Mesh){\r\n\t\t\t\tchild.material = modelMaterial;\r\n            }\r\n\t\t});\r\n\r\n        scene.Add(obj);\r\n    });\r\n\r\n    \r\n    // NavCam\r\n    var debug = true;\r\n    navCam = new V3d.Navigation.NavCam({\r\n        scene: scene.scene,\r\n        resolution: new THREE.Vector2(128, 128),\r\n        growth: 1,\r\n\r\n        arcLengthDivisions: 60,\r\n        smoothPath: 3,\r\n        tryGetRange: 4,\r\n\r\n        debug: debug\r\n    });\r\n    //scene.Add(navCam.areaCam.camera);\r\n    if(debug) scene.Add(navCam.areaCam.debugView);\r\n    if(debug) scene.Add(navCam.pathfinder.debugView);\r\n\r\n    var down = new THREE.Vector3(0, -1, 0);\r\n    navCam.areaCam.SetRegion(-10, 10, 10, -10, 5, 8, down, 20, 20);\r\n    //navCam.areaCam.camera.position.x = navCam.areaCam.camera.position.z = 20;\r\n    //navCam.areaCam.camera.rotation.x += .01;\r\n    //navCam.areaCam.camera.rotation.y += .01;\r\n\r\n\t// events\r\n    input.keyboard.on('space', function(){\r\n        navCam.Update();\r\n        //obj.position.x += 1;\r\n    });\r\n    \r\n    var gotoIndex = 0;\r\n    var goto = [];\r\n    var clock = new THREE.Clock();\r\n    var draw = function(){\r\n        //console.log('draw');\r\n        var mv = input.mouseViewport;\r\n        var viewportPoint = new THREE.Vector3(mv.x, mv.y, 0);\r\n        var worldPos = ViewportToWorldPlane(viewportPoint, input.camera);\r\n        worldPos.y = 6;\r\n        helper.position.copy(worldPos);\r\n        goto[gotoIndex] = worldPos.clone();\r\n\r\n        helper.visible = false;\r\n        sphere.visible = false;\r\n        if(goto[0] !== undefined && goto[1] !== undefined){\r\n            var curve = navCam.Solve(goto[0], goto[1]);\r\n            if(curve !== undefined){\r\n                var t = clock.getElapsedTime();\r\n                var tCurve = t / Math.min(2, (curve.points.length / 2));\r\n                var modT = tCurve % 1;\r\n                var pointAtTime = navCam.pathfinder.GetAt(modT).clone();\r\n                if(pointAtTime !== undefined) sphere.position.copy(pointAtTime);\r\n\r\n                var pointAhead = navCam.pathfinder.GetAt((modT + .5) % 1).clone();\r\n                postRender = function(){\r\n                    updateViewCamera(pointAtTime, pointAhead);\r\n                };\r\n            }\r\n        }\r\n        helper.visible = true;\r\n        sphere.visible = true;\r\n    };\r\n    \r\n    var scope = this;\r\n\tinput.onMouseDown.push(function(mouseEvent){\r\n        //console.log('onMouseDown');\r\n\t\tif(mouseEvent.ctrlKey){\r\n            input.EnableSceneControls(false);\r\n            gotoIndex = 0;\r\n            draw();\r\n            gotoIndex = 1;\r\n            input.Repeat(draw, 45);\r\n            clock.start();\r\n\t\t}\r\n    });\r\n\r\n    input.onMouseUp.push(function(e){\r\n        input.StopRepeat(draw);\r\n        input.EnableSceneControls(true);\r\n        sphere.position.set(0, 0, 0);\r\n        clock.stop();\r\n    });\r\n\r\n    //this.input.RemoveEventCallback('onMouseDown', onMouseDown);\r\n    \r\n    return {navCam, scene, input};\r\n}\r\n\r\nmodule.exports = Run;","\r\nclass FlowCamera{\r\n    constructor(container){\r\n        FlowCamera.instance = this;\r\n\r\n        const Scene = require('./Scene');\r\n        \r\n        this.camera = new THREE.PerspectiveCamera(45, 1, 1 * Scene.units, 2000 * Scene.units);\r\n        this.camera.name = 'V3fCamera';\r\n        this.camera.controller = this;\r\n        console.log('Created ' + this.camera.name, this.camera);\r\n\r\n        this.container = container;\r\n\r\n        // controls\r\n        this.controls = new THREE.OrbitControls(this.camera, this.container);\r\n        this.controls.target = new THREE.Vector3();\r\n        this.controls.userPan = false;\r\n        this.controls.userPanSpeed = 0.0;\r\n        this.controls.maxDistance = 5000.0;\r\n        this.controls.maxPolarAngle = Math.PI * 0.895;\r\n        this.controls.autoRotate = false;\r\n        this.controls.autoRotateSpeed = 1.0;\r\n        this.controls.enableKeys = false;\r\n    }\r\n\r\n    Unload(){\r\n        this.controls.enabled = false;\r\n    }\r\n\r\n    Load(){\r\n        this.controls.enabled = true;\r\n    }\r\n\r\n    Update(){\r\n        this.controls.update();\r\n    }\r\n\r\n}\r\n\r\nmodule.exports = FlowCamera;","\r\nconst Scene = require('./Scene');\r\nconst keypress = require('./lib/keypress');\r\nconst getAbsoluteBoundingRect = require('./lib/getAbsoluteBoundingRect');\r\n\r\nclass RaycastGroup{\r\n    constructor(items, callback, collectionQuery, recursive){\r\n        this.items = items;\r\n        this.callback = callback;\r\n        this.recursive = recursive !== undefined ? recursive : false;\r\n\r\n        if(collectionQuery === undefined){\r\n            this.raycastItems = this.items;\r\n        }\r\n        else{\r\n            this.raycastItems = [];\r\n            this.collectionQuery = collectionQuery;\r\n            this.GetRaycastItems(this.collectionQuery);\r\n        }\r\n    }\r\n\r\n    GetRaycastItems(collectionQuery){\r\n        for(var iItem = 0, numItems = this.items.length; iItem < numItems; iItem++){\r\n            this.raycastItems.push(collectionQuery(this.items[iItem]));\r\n        }\r\n    }\r\n\r\n    UpdateItems(items, collectionQuery){\r\n        collectionQuery = collectionQuery !== undefined ? collectionQuery : this.collectionQuery;\r\n        this.raycastItems.length;\r\n        this.GetRaycastItems(collectionQuery);\r\n    }\r\n\r\n    Raycast(raycaster){\r\n        var intersects = raycaster.intersectObjects(this.raycastItems, this.recursive);\r\n        var numIntersects = intersects.length;\r\n        if (numIntersects > 0) {\r\n            for(var iIntersect = 0; iIntersect < numIntersects; iIntersect++){\r\n                var targetObject3d = intersects[0].object;\r\n                var targetAsset = undefined;//CK.Helpers3d.FindPropertyInParents('asset', targetObject3d);\r\n                if(targetAsset !== undefined) this.callback(targetAsset.sceneItem, intersects[0]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass Input{\r\n\r\n    static get camera(){\r\n        return Scene.instance.camera;\r\n    }\r\n\r\n    static Init(camera, domContainer){\r\n        this.domContainer = domContainer;\r\n\r\n        this._mouse = {x:0, y:0};\r\n        this.mouseScreen = new THREE.Vector2();\r\n        this.mouseViewport = new THREE.Vector2();\r\n        this.lastMouseDownTime = 0;\r\n\t    this.screen = getAbsoluteBoundingRect(this.domContainer);\r\n\r\n        this.raycaster = new THREE.Raycaster();\r\n\r\n        this.clock = new THREE.Clock();\r\n        this.clock.start();\r\n\r\n        this._raycastGroups = {Update:{}, OnMouseDown:{}, OnDoubleClick:{}, OnMouseUp:{}, OnRightClick:{}};\r\n        this.fireOnce = [];\r\n\r\n        this.onEnterFrame = [];\r\n        this.onMouseDown = [];\r\n        this.onMouseUp = [];\r\n        this.onRightClick = [];\r\n        this.onDoubleClick = [];\r\n        \r\n        document.addEventListener('mousedown', this.OnMouseDown.bind(this));\r\n        document.addEventListener('mouseup', this.OnMouseUp.bind(this));\r\n        document.addEventListener('contextmenu', this.OnRightClick.bind(this));\r\n        document.addEventListener('mousemove', this.OnMouseMove.bind(this), false);\r\n\r\n        this.screenNeedsUpdate = true;\r\n        window.addEventListener('scroll', this.OnScroll.bind(this));\r\n\r\n        this.cameraNeedsUpdate = true;\r\n        this.onResize = [];\r\n        window.addEventListener('resize', this.OnResize.bind(this));\r\n\r\n        this.keyboard = new keypress.Listener();\r\n        this.keyboard.on = this.keyboard.simple_combo;\r\n    }\r\n\r\n    static OnMouseDown(mouseEvent){\r\n        if(mouseEvent.button === 0){\r\n            var now = this.clock.getElapsedTime();\r\n            if(now - this.lastMouseDownTime < .2){\r\n                this.OnDoubleClick(mouseEvent);\r\n                return;\r\n            }\r\n\r\n            this.lastMouseDownTime = now;\r\n\r\n            for(var i = 0; i < this.onMouseDown.length; i++){\r\n                this.onMouseDown[i](mouseEvent);\r\n            }\r\n\r\n            this.UpdateRaycast('OnMouseDown');\r\n        }\r\n    }\r\n\r\n    static OnDoubleClick(mouseEvent){\r\n        for(var i = 0; i < this.onDoubleClick.length; i++){\r\n            this.onDoubleClick[i](mouseEvent);\r\n        }\r\n\r\n        this.UpdateRaycast('OnDoubleClick');\r\n    }\r\n\r\n    static OnMouseUp(mouseEvent){\r\n        if(mouseEvent.button === 0){\r\n            for(var i = 0; i < this.onMouseUp.length; i++){\r\n                this.onMouseUp[i](mouseEvent);\r\n            }\r\n\r\n            this.UpdateRaycast('OnMouseUp');\r\n        }\r\n    }\r\n\r\n    static OnRightClick(mouseEvent){\r\n        event.preventDefault();\r\n        for(var i = 0; i < this.onRightClick.length; i++){\r\n            this.onRightClick[i](mouseEvent);\r\n        }\r\n\r\n        this.UpdateRaycast('OnRightClick');\r\n    }\r\n\r\n    static OnMouseMove(mouseEvent){\r\n        this._mouse.x = mouseEvent.clientX - this.screen.left;\r\n        this._mouse.y = mouseEvent.clientY - this.screen.top;\r\n    }\r\n\r\n    static OnScroll(event){\r\n        this.screenNeedsUpdate = true;\r\n    }\r\n\r\n    static OnResize(event) {\r\n        this.screenNeedsUpdate = true;\r\n        this.cameraNeedsUpdate = true;\r\n    }\r\n\r\n    static RemoveEventCallback(eventType, callback){\r\n        var callbacks = this[eventType];\r\n        for(var iCallback = 0; iCallback < callbacks.length; iCallback++){\r\n            if(callbacks[iCallback] === callback){\r\n                callbacks.splice(iCallback, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    static Update(){\r\n        this.UpdateScreenAndMouse();\r\n\r\n        this.FireOnce();\r\n\r\n        for(var iFrame = 0; iFrame < this.onEnterFrame.length; iFrame++) this.onEnterFrame[iFrame]();\r\n\r\n        this.UpdateRaycast('Update');\r\n    }\r\n\r\n    static FireOnce(){\r\n        var numCallbacks = this.fireOnce.length;\r\n        for(var iCallback = numCallbacks; iCallback-- > 0;){\r\n            this.fireOnce[iCallback]();\r\n            this.fireOnce.splice(iCallback, 1);\r\n        }\r\n    }\r\n\r\n    static DelayedAction(action, delay){\r\n        var drid = window.setInterval(function(){\r\n            action();\r\n            window.clearInterval(drid);\r\n        }, delay);\r\n    }\r\n\r\n    static Repeat(action, interval){\r\n        if(this._repeats === undefined) this._repeats = [];\r\n        var drid = window.setInterval(function(){\r\n            action();\r\n        }, interval);\r\n        this._repeats.push({action:action, drid:drid});\r\n        return drid;\r\n    }\r\n\r\n    static StopRepeat(action){\r\n        if(this._repeats === undefined) return;\r\n\r\n        if(typeof action === 'number'){\r\n            window.clearInterval(action);\r\n            return;\r\n        }\r\n\r\n        for(var i = 0; i < this._repeats.length; i++){\r\n            if(this._repeats[i].action === action){\r\n                window.clearInterval(this._repeats[i].drid);\r\n                this._repeats.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static UpdateScreenAndMouse(){\r\n        if(this.screenNeedsUpdate) {\r\n            //this.screen = getAbsoluteBoundingRect(this.domContainer);\r\n            this.screen = this.domContainer.getBoundingClientRect();\r\n            this.screenNeedsUpdate = false;\r\n        }\r\n        if(this.cameraNeedsUpdate) {\r\n            for(var i = 0; i < this.onResize.length; i++){\r\n                this.onResize[i](this.screen);\r\n            }\r\n            this.cameraNeedsUpdate = false;\r\n        }\r\n\r\n        this.mouseScreen.x = this._mouse.x;\r\n        this.mouseScreen.y = this._mouse.y;\r\n\r\n        this.mouseViewport.x = this._mouse.x / this.screen.width * 2 - 1;\r\n        this.mouseViewport.y = -this._mouse.y / this.screen.height * 2 + 1;\r\n    }\r\n\r\n    static EnableSceneControls(value){\r\n        this.camera.controller.controls.enabled = value;\r\n    }\r\n\r\n    static RaycastTest(objects, recursive){\r\n        this.UpdateRaycaster();\r\n        recursive = recursive !== undefined ? recursive : false;\r\n        var intersects = objects instanceof Array ? this.raycaster.intersectObjects(objects, recursive) : this.raycaster.intersectObject(objects, recursive);\r\n        if (intersects.length > 0) {\r\n            return intersects[0];\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    static AddRaycastGroup(event, groupID, group){\r\n        this._raycastGroups[event][groupID] = group;\r\n    }\r\n\r\n    static RemoveRaycastGroup(event, groupID){\r\n        delete this._raycastGroups[event][groupID];\r\n    }\r\n\r\n    static UpdateRaycaster(){\r\n        this.camera.updateMatrixWorld();\r\n        this.raycaster.setFromCamera(this.mouseViewport, this.camera);\r\n    }\r\n\r\n    static UpdateRaycast(event){\r\n        var raycastGroupsKeys = Object.keys(this._raycastGroups[event]);\r\n        var numRaycastGroups = raycastGroupsKeys.length;\r\n        if(numRaycastGroups > 0){\r\n            this.UpdateRaycaster();\r\n            for(var iGroup = 0; iGroup < numRaycastGroups; iGroup++){\r\n                var key = raycastGroupsKeys[iGroup];\r\n                this._raycastGroups[event][key].Raycast(this.raycaster);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Input;\r\nmodule.exports.RaycastGroup = RaycastGroup;","\r\nconst FlowCamera = require('./FlowCamera');\r\n\r\nclass Scene{\r\n\r\n    static get units(){ return 1; }\r\n\r\n    constructor(){\r\n        Scene.instance = this;\r\n    \r\n        this._camera, this.scene, this.renderer;\r\n    \r\n        this.itemsContainer = new THREE.Object3D();\r\n        this.itemsContainer.name = \"itemsContainer\";\r\n        this.miscContainer = new THREE.Object3D();\r\n        this.miscContainer.name = \"miscContainer\";\r\n        this.ambientContainer = new THREE.Object3D();\r\n        this.ambientContainer.name = \"ambientContainer\";\r\n    \r\n        this.defaults = new THREE.Object3D();\r\n        this.defaults.name = \"defaults\";\r\n        \r\n        this.items = [];\r\n    \r\n        this.stack = [];\r\n\r\n        this.postRender = [];\r\n    }\r\n    \r\n    get camera(){\r\n        return this._camera;\r\n    }\r\n    set camera(value){\r\n        this._camera = value;\r\n    }\r\n    \r\n    ShowItems3DHelpers(value){\r\n        for(var i = 0, len = this.items.length; i < len; i++){\r\n            this.items[i].ShowItems3DHelpers(value);\r\n        }\r\n    }\r\n    \r\n    Push(){\r\n        this.stack.push(this.Snapshot());\r\n        this.Reset();\r\n    }\r\n    \r\n    Pop(){\r\n        this.LoadSnapshot(this.stack.pop());\r\n    }\r\n    \r\n    Snapshot(){\r\n        var snapshot = {};\r\n        \r\n        snapshot.camera = {position: this.camera.position.clone(), rotation: this.camera.rotation.clone()};\r\n        \r\n        snapshot.items = this.items;\r\n        \r\n        snapshot.itemsContainer = this.itemsContainer;\r\n        snapshot.miscContainer = this.miscContainer;\r\n        snapshot.ambientContainer = this.ambientContainer;\r\n        \r\n        return snapshot;\r\n    }\r\n    \r\n    LoadSnapshot(snapshot){\r\n        this.Clear();\r\n    \r\n        this.camera.position.copy(snapshot.camera.position);\r\n        this.camera.rotation.copy(snapshot.camera.rotation);\r\n        \r\n        this.items = snapshot.items;\r\n    \r\n        this.itemsContainer = snapshot.itemsContainer;\r\n        this.miscContainer = snapshot.miscContainer;\r\n        this.ambientContainer = snapshot.ambientContainer;\r\n    \r\n        // Setup rest\r\n        this.scene.add(this.itemsContainer);\r\n        this.scene.add(this.miscContainer);\r\n        this.scene.add(this.ambientContainer);\r\n    }\r\n    \r\n    Clear(){\r\n        this.scene.remove(this.itemsContainer, this.miscContainer, this.ambientContainer);\r\n    }\r\n    \r\n    Reset(){\r\n        \r\n        this.items = [];\r\n    \r\n        this.Clear();\r\n    \r\n        this.itemsContainer = new THREE.Object3D();\r\n        this.itemsContainer.name = \"itemsContainer\";\r\n        this.miscContainer = new THREE.Object3D();\r\n        this.miscContainer.name = \"miscContainer\";\r\n        this.ambientContainer = new THREE.Object3D();\r\n        this.ambientContainer.name = \"ambientContainer\";\r\n    \r\n        // Setup rest\r\n        this.scene.add(this.itemsContainer);\r\n        this.scene.add(this.miscContainer);\r\n        this.scene.add(this.ambientContainer);\r\n    }\r\n    \r\n    Init(container){\r\n        // Camera\r\n        this.camera = new FlowCamera(container).camera;\r\n        //else this.camera = new THREE.PerspectiveCamera(45, 1, 1 * Scene.units, 2000 * Scene.units);\r\n        \r\n        // Scene\r\n        this.scene = new THREE.Scene();\r\n        window.scene = this.scene;\r\n    \r\n        // Renderer\r\n        this.renderer = new THREE.WebGLRenderer({antialias: true});\r\n        this.renderer.setClearColor(new THREE.Color(0x323232), 1);\r\n        this.renderer.setPixelRatio(window.devicePixelRatio);\r\n    \r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n    \r\n        this.renderer.physicallyCorrectLights = true;\r\n        this.renderer.gammaInput = true;\r\n        this.renderer.gammaOutput = true;\r\n        this.renderer.toneMapping = THREE.ReinhardToneMapping;\r\n        \r\n        // Fill lights\r\n        this.DefaultLights();\r\n    \r\n        // Setup rest\r\n        this.scene.add(this.itemsContainer);\r\n        this.scene.add(this.miscContainer);\r\n        this.scene.add(this.ambientContainer);\r\n        this.scene.add(this.defaults);\r\n    }\r\n    \r\n    Add(object){\r\n        if(false){\r\n            var view = object.view;\r\n    \r\n            this.items.push(object);\r\n            this.itemsContainer.add(view);\r\n    \r\n            object.ShowItems3DHelpers();\r\n        }\r\n        else {\r\n            this.miscContainer.add(object);\r\n        }\r\n    }\r\n    \r\n    AddDefault(object){\r\n        this.defaults.add(object);\r\n    }\r\n    \r\n    Remove(object){\r\n        if(typeof object === 'string'){\r\n            var objName = object;\r\n            object = this.itemsContainer.getObjectByName(objName);\r\n            if(object !== undefined) object = this.miscContainer.getObjectByName(objName);\r\n            if(object === undefined) return;\r\n        }\r\n        this.itemsContainer.remove(object);\r\n        this.miscContainer.remove(object);\r\n    }\r\n    \r\n    DefaultLights(){\r\n        var ambient = new THREE.AmbientLight( 0x404040 );\r\n    \r\n        var directionalLight = new THREE.DirectionalLight(0xfeeedd);\r\n        directionalLight.position.set(7 * Scene.units, 15 * Scene.units, 30 * Scene.units);\r\n    /*\r\n        directionalLight.castShadow = true;\r\n        directionalLight.shadow.mapSize.width = 2048;\r\n        directionalLight.shadow.mapSize.height = 2048;\r\n        directionalLight.shadow.camera.near = .5 * Scene.units;\r\n        directionalLight.shadow.camera.far = 100 * Scene.units;\r\n        directionalLight.shadow.camera.bottom = directionalLight.shadow.camera.left = -50 * Scene.units;\r\n        directionalLight.shadow.camera.top = directionalLight.shadow.camera.right = 50 * Scene.units;\r\n        directionalLight.shadow.camera.updateProjectionMatrix();\r\n        \r\n        var shadowCamerHelper = new THREE.CameraHelper(directionalLight.shadow.camera);\r\n        this.ambientContainer.add(shadowCamerHelper);*/\r\n        \r\n        this.ambientContainer.add(ambient);\r\n        this.ambientContainer.add(directionalLight);\r\n    }\r\n    \r\n    SceneLight(light){\r\n        if(light === undefined){\r\n            light = new THREE.PointLight(0xffee88, 3, 10 * Scene.units, 2);\r\n            light.position.set(4 * Scene.units, 4 * Scene.units, 0);\r\n            light.castShadow = true;\r\n            light.power = 3.4;\r\n        }\r\n    \r\n        this.ambientContainer.add(light);\r\n    \r\n        if(typeof V3f !== 'undefined' && V3f.LightsEditor !== undefined){\r\n            V3f.LightsEditor.Add(light);\r\n        }\r\n    }\r\n    \r\n    FindSection(sectionID){\r\n        for(var iItem = 0, numItems = this.items.length; iItem < numItems; iItem++){\r\n            var item = this.items[iItem];\r\n            if(item !== undefined && item.sov !== undefined && item.sov.GetValue('s') === sectionID){\r\n                return item;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    \r\n    Update(){\r\n        this.camera.controller.Update();\r\n        this.Render();\r\n    }\r\n    \r\n    Render() {\r\n        this.renderer.render(this.scene, this.camera);\r\n\r\n        for(var iPR = 0; iPR < this.postRender.length; iPR++) this.postRender[iPR]();\r\n    }\r\n    \r\n    ReconfigureViewport(screen){\r\n        this.camera.aspect = screen.width / screen.height;\r\n        this.camera.updateProjectionMatrix();\r\n        this.renderer.setSize(screen.width, screen.height);\r\n    }\r\n    \r\n    static LightFromJSON(data){\r\n        var light;\r\n    \r\n        switch(data.type){\r\n            case 'PointLight':\r\n            light = new THREE.PointLight(data.colorHex, data.intensity, data.distance, data.decay);\r\n            light.name = data.name;\r\n            light.power = data.power;\r\n            light.castShadow = data.castShadow;\r\n            light.position.set(data.position.x, data.position.y, data.position.z);\r\n            break;\r\n        }\r\n    \r\n        return light;\r\n    }\r\n}\r\n\r\nglobal.Scene = Scene;\r\nmodule.exports = Scene;","/**\r\n@author rgrove\r\nhttps://gist.github.com/rgrove/5463265\r\nReturns a bounding rect for _el_ with absolute coordinates corrected for\r\nscroll positions.\r\n\r\nThe native `getBoundingClientRect()` returns coordinates for an element's\r\nvisual position relative to the top left of the viewport, so if the element\r\nis part of a scrollable region that has been scrolled, its coordinates will\r\nbe different than if the region hadn't been scrolled.\r\n\r\nThis method corrects for scroll offsets all the way up the node tree, so the\r\nreturned bounding rect will represent an absolute position on a virtual\r\ncanvas, regardless of scrolling.\r\n\r\n@method getAbsoluteBoundingRect\r\n@param {HTMLElement} el HTML element.\r\n@return {Object} Absolute bounding rect for _el_.\r\n**/\r\n\r\nfunction getAbsoluteBoundingRect (el) {\r\n    var doc  = document,\r\n        win  = window,\r\n        body = doc.body,\r\n\r\n        // pageXOffset and pageYOffset work everywhere except IE <9.\r\n        offsetX = win.pageXOffset !== undefined ? win.pageXOffset :\r\n            (doc.documentElement || body.parentNode || body).scrollLeft,\r\n        offsetY = win.pageYOffset !== undefined ? win.pageYOffset :\r\n            (doc.documentElement || body.parentNode || body).scrollTop,\r\n\r\n        rect = el.getBoundingClientRect();\r\n\r\n    if (el !== body) {\r\n        var parent = el.parentNode;\r\n\r\n        // The element's rect will be affected by the scroll positions of\r\n        // *all* of its scrollable parents, not just the window, so we have\r\n        // to walk up the tree and collect every scroll offset. Good times.\r\n        while (parent !== body && parent !== null) {\r\n            offsetX += parent.scrollLeft;\r\n            offsetY += parent.scrollTop;\r\n            parent   = parent.parentNode;\r\n        }\r\n    }\r\n\r\n    return {\r\n        bottom: rect.bottom + offsetY,\r\n        height: rect.height,\r\n        left  : rect.left + offsetX,\r\n        right : rect.right + offsetX,\r\n        top   : rect.top + offsetY,\r\n        width : rect.width\r\n    };\r\n}\r\n\r\nmodule.exports = getAbsoluteBoundingRect;","// Generated by CoffeeScript 1.8.0\r\n\r\n/*\r\nCopyright 2014 David Mauro\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n\r\nKeypress is a robust keyboard input capturing Javascript utility\r\nfocused on input for games.\r\n\r\nversion 2.1.3\r\n */\r\n\r\n\r\n/*\r\nCombo options available and their defaults:\r\n    keys            : []            - An array of the keys pressed together to activate combo.\r\n    count           : 0             - The number of times a counting combo has been pressed. Reset on release.\r\n    is_unordered    : false         - Unless this is set to true, the keys can be pressed down in any order.\r\n    is_counting     : false         - Makes this a counting combo (see documentation).\r\n    is_exclusive    : false         - This combo will replace other exclusive combos when true.\r\n    is_solitary     : false         - This combo will only fire if ONLY it's keys are pressed down.\r\n    is_sequence     : false         - Rather than a key combo, this is an ordered key sequence.\r\n    prevent_default : false         - Prevent default behavior for all component key keypresses.\r\n    prevent_repeat  : false         - Prevent the combo from repeating when keydown is held.\r\n    on_keydown      : null          - A function that is called when the combo is pressed.\r\n    on_keyup        : null          - A function that is called when the combo is released.\r\n    on_release      : null          - A function that is called when all keys in the combo are released.\r\n    this            : undefined     - Defines the scope for your callback functions.\r\n */\r\n\r\n(function() {\r\n  var Combo, keypress, _change_keycodes_by_browser, _compare_arrays, _compare_arrays_sorted, _convert_key_to_readable, _convert_to_shifted_key, _decide_meta_key, _factory_defaults, _filter_array, _index_of_in_array, _is_array_in_array, _is_array_in_array_sorted, _key_is_valid, _keycode_alternate_names, _keycode_dictionary, _keycode_shifted_keys, _log_error, _metakey, _modifier_event_mapping, _modifier_keys, _validate_combo,\r\n    __hasProp = {}.hasOwnProperty,\r\n    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\r\n\r\n  _factory_defaults = {\r\n    is_unordered: false,\r\n    is_counting: false,\r\n    is_exclusive: false,\r\n    is_solitary: false,\r\n    prevent_default: false,\r\n    prevent_repeat: false\r\n  };\r\n\r\n  _modifier_keys = [\"meta\", \"alt\", \"option\", \"ctrl\", \"shift\", \"cmd\"];\r\n\r\n  _metakey = \"ctrl\";\r\n\r\n  keypress = {};\r\n\r\n  keypress.debug = false;\r\n\r\n  Combo = (function() {\r\n    function Combo(dictionary) {\r\n      var property, value;\r\n      for (property in dictionary) {\r\n        if (!__hasProp.call(dictionary, property)) continue;\r\n        value = dictionary[property];\r\n        if (value !== false) {\r\n          this[property] = value;\r\n        }\r\n      }\r\n      this.keys = this.keys || [];\r\n      this.count = this.count || 0;\r\n    }\r\n\r\n    Combo.prototype.allows_key_repeat = function() {\r\n      return !this.prevent_repeat && typeof this.on_keydown === \"function\";\r\n    };\r\n\r\n    Combo.prototype.reset = function() {\r\n      this.count = 0;\r\n      return this.keyup_fired = null;\r\n    };\r\n\r\n    return Combo;\r\n\r\n  })();\r\n\r\n  keypress.Listener = (function() {\r\n    function Listener(element, defaults) {\r\n      var attach_handler, property, value;\r\n      if ((typeof jQuery !== \"undefined\" && jQuery !== null) && element instanceof jQuery) {\r\n        if (element.length !== 1) {\r\n          _log_error(\"Warning: your jQuery selector should have exactly one object.\");\r\n        }\r\n        element = element[0];\r\n      }\r\n      this.should_suppress_event_defaults = false;\r\n      this.should_force_event_defaults = false;\r\n      this.sequence_delay = 800;\r\n      this._registered_combos = [];\r\n      this._keys_down = [];\r\n      this._active_combos = [];\r\n      this._sequence = [];\r\n      this._sequence_timer = null;\r\n      this._prevent_capture = false;\r\n      this._defaults = defaults || {};\r\n      for (property in _factory_defaults) {\r\n        if (!__hasProp.call(_factory_defaults, property)) continue;\r\n        value = _factory_defaults[property];\r\n        this._defaults[property] = this._defaults[property] || value;\r\n      }\r\n      this.element = element || document.body;\r\n      attach_handler = function(target, event, handler) {\r\n        if (target.addEventListener) {\r\n          target.addEventListener(event, handler);\r\n        } else if (target.attachEvent) {\r\n          target.attachEvent(\"on\" + event, handler);\r\n        }\r\n        return handler;\r\n      };\r\n      this.keydown_event = attach_handler(this.element, \"keydown\", (function(_this) {\r\n        return function(e) {\r\n          e = e || window.event;\r\n          _this._receive_input(e, true);\r\n          return _this._bug_catcher(e);\r\n        };\r\n      })(this));\r\n      this.keyup_event = attach_handler(this.element, \"keyup\", (function(_this) {\r\n        return function(e) {\r\n          e = e || window.event;\r\n          return _this._receive_input(e, false);\r\n        };\r\n      })(this));\r\n      this.blur_event = attach_handler(window, \"blur\", (function(_this) {\r\n        return function() {\r\n          var key, _i, _len, _ref;\r\n          _ref = _this._keys_down;\r\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n            key = _ref[_i];\r\n            _this._key_up(key, {});\r\n          }\r\n          return _this._keys_down = [];\r\n        };\r\n      })(this));\r\n    }\r\n\r\n    Listener.prototype.destroy = function() {\r\n      var remove_handler;\r\n      remove_handler = function(target, event, handler) {\r\n        if (target.removeEventListener != null) {\r\n          return target.removeEventListener(event, handler);\r\n        } else if (target.removeEvent != null) {\r\n          return target.removeEvent(\"on\" + event, handler);\r\n        }\r\n      };\r\n      remove_handler(this.element, \"keydown\", this.keydown_event);\r\n      remove_handler(this.element, \"keyup\", this.keyup_event);\r\n      return remove_handler(window, \"blur\", this.blur_event);\r\n    };\r\n\r\n    Listener.prototype._bug_catcher = function(e) {\r\n      var _ref, _ref1;\r\n      if (_metakey === \"cmd\" && __indexOf.call(this._keys_down, \"cmd\") >= 0 && ((_ref = _convert_key_to_readable((_ref1 = e.keyCode) != null ? _ref1 : e.key)) !== \"cmd\" && _ref !== \"shift\" && _ref !== \"alt\" && _ref !== \"caps\" && _ref !== \"tab\")) {\r\n        return this._receive_input(e, false);\r\n      }\r\n    };\r\n\r\n    Listener.prototype._cmd_bug_check = function(combo_keys) {\r\n      if (_metakey === \"cmd\" && __indexOf.call(this._keys_down, \"cmd\") >= 0 && __indexOf.call(combo_keys, \"cmd\") < 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    };\r\n\r\n    Listener.prototype._prevent_default = function(e, should_prevent) {\r\n      if ((should_prevent || this.should_suppress_event_defaults) && !this.should_force_event_defaults) {\r\n        if (e.preventDefault) {\r\n          e.preventDefault();\r\n        } else {\r\n          e.returnValue = false;\r\n        }\r\n        if (e.stopPropagation) {\r\n          return e.stopPropagation();\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._get_active_combos = function(key) {\r\n      var active_combos, keys_down;\r\n      active_combos = [];\r\n      keys_down = _filter_array(this._keys_down, function(down_key) {\r\n        return down_key !== key;\r\n      });\r\n      keys_down.push(key);\r\n      this._match_combo_arrays(keys_down, (function(_this) {\r\n        return function(match) {\r\n          if (_this._cmd_bug_check(match.keys)) {\r\n            return active_combos.push(match);\r\n          }\r\n        };\r\n      })(this));\r\n      this._fuzzy_match_combo_arrays(keys_down, (function(_this) {\r\n        return function(match) {\r\n          if (__indexOf.call(active_combos, match) >= 0) {\r\n            return;\r\n          }\r\n          if (!(match.is_solitary || !_this._cmd_bug_check(match.keys))) {\r\n            return active_combos.push(match);\r\n          }\r\n        };\r\n      })(this));\r\n      return active_combos;\r\n    };\r\n\r\n    Listener.prototype._get_potential_combos = function(key) {\r\n      var combo, potentials, _i, _len, _ref;\r\n      potentials = [];\r\n      _ref = this._registered_combos;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        combo = _ref[_i];\r\n        if (combo.is_sequence) {\r\n          continue;\r\n        }\r\n        if (__indexOf.call(combo.keys, key) >= 0 && this._cmd_bug_check(combo.keys)) {\r\n          potentials.push(combo);\r\n        }\r\n      }\r\n      return potentials;\r\n    };\r\n\r\n    Listener.prototype._add_to_active_combos = function(combo) {\r\n      var active_combo, active_key, active_keys, already_replaced, combo_key, i, should_prepend, should_replace, _i, _j, _k, _len, _len1, _ref, _ref1;\r\n      should_replace = false;\r\n      should_prepend = true;\r\n      already_replaced = false;\r\n      if (__indexOf.call(this._active_combos, combo) >= 0) {\r\n        return true;\r\n      } else if (this._active_combos.length) {\r\n        for (i = _i = 0, _ref = this._active_combos.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n          active_combo = this._active_combos[i];\r\n          if (!(active_combo && active_combo.is_exclusive && combo.is_exclusive)) {\r\n            continue;\r\n          }\r\n          active_keys = active_combo.keys;\r\n          if (!should_replace) {\r\n            for (_j = 0, _len = active_keys.length; _j < _len; _j++) {\r\n              active_key = active_keys[_j];\r\n              should_replace = true;\r\n              if (__indexOf.call(combo.keys, active_key) < 0) {\r\n                should_replace = false;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (should_prepend && !should_replace) {\r\n            _ref1 = combo.keys;\r\n            for (_k = 0, _len1 = _ref1.length; _k < _len1; _k++) {\r\n              combo_key = _ref1[_k];\r\n              should_prepend = false;\r\n              if (__indexOf.call(active_keys, combo_key) < 0) {\r\n                should_prepend = true;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (should_replace) {\r\n            if (already_replaced) {\r\n              active_combo = this._active_combos.splice(i, 1)[0];\r\n              if (active_combo != null) {\r\n                active_combo.reset();\r\n              }\r\n            } else {\r\n              active_combo = this._active_combos.splice(i, 1, combo)[0];\r\n              if (active_combo != null) {\r\n                active_combo.reset();\r\n              }\r\n              already_replaced = true;\r\n            }\r\n            should_prepend = false;\r\n          }\r\n        }\r\n      }\r\n      if (should_prepend) {\r\n        this._active_combos.unshift(combo);\r\n      }\r\n      return should_replace || should_prepend;\r\n    };\r\n\r\n    Listener.prototype._remove_from_active_combos = function(combo) {\r\n      var active_combo, i, _i, _ref;\r\n      for (i = _i = 0, _ref = this._active_combos.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n        active_combo = this._active_combos[i];\r\n        if (active_combo === combo) {\r\n          combo = this._active_combos.splice(i, 1)[0];\r\n          combo.reset();\r\n          break;\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._get_possible_sequences = function() {\r\n      var combo, i, j, match, matches, sequence, _i, _j, _k, _len, _ref, _ref1, _ref2;\r\n      matches = [];\r\n      _ref = this._registered_combos;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        combo = _ref[_i];\r\n        for (j = _j = 1, _ref1 = this._sequence.length; 1 <= _ref1 ? _j <= _ref1 : _j >= _ref1; j = 1 <= _ref1 ? ++_j : --_j) {\r\n          sequence = this._sequence.slice(-j);\r\n          if (!combo.is_sequence) {\r\n            continue;\r\n          }\r\n          if (__indexOf.call(combo.keys, \"shift\") < 0) {\r\n            sequence = _filter_array(sequence, function(key) {\r\n              return key !== \"shift\";\r\n            });\r\n            if (!sequence.length) {\r\n              continue;\r\n            }\r\n          }\r\n          for (i = _k = 0, _ref2 = sequence.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {\r\n            if (combo.keys[i] === sequence[i]) {\r\n              match = true;\r\n            } else {\r\n              match = false;\r\n              break;\r\n            }\r\n          }\r\n          if (match) {\r\n            matches.push(combo);\r\n          }\r\n        }\r\n      }\r\n      return matches;\r\n    };\r\n\r\n    Listener.prototype._add_key_to_sequence = function(key, e) {\r\n      var combo, sequence_combos, _i, _len;\r\n      this._sequence.push(key);\r\n      sequence_combos = this._get_possible_sequences();\r\n      if (sequence_combos.length) {\r\n        for (_i = 0, _len = sequence_combos.length; _i < _len; _i++) {\r\n          combo = sequence_combos[_i];\r\n          this._prevent_default(e, combo.prevent_default);\r\n        }\r\n        if (this._sequence_timer) {\r\n          clearTimeout(this._sequence_timer);\r\n        }\r\n        if (this.sequence_delay > -1) {\r\n          this._sequence_timer = setTimeout(function() {\r\n            return this._sequence = [];\r\n          }, this.sequence_delay);\r\n        }\r\n      } else {\r\n        this._sequence = [];\r\n      }\r\n    };\r\n\r\n    Listener.prototype._get_sequence = function(key) {\r\n      var combo, i, j, match, seq_key, sequence, _i, _j, _k, _len, _ref, _ref1, _ref2;\r\n      _ref = this._registered_combos;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        combo = _ref[_i];\r\n        if (!combo.is_sequence) {\r\n          continue;\r\n        }\r\n        for (j = _j = 1, _ref1 = this._sequence.length; 1 <= _ref1 ? _j <= _ref1 : _j >= _ref1; j = 1 <= _ref1 ? ++_j : --_j) {\r\n          sequence = (_filter_array(this._sequence, function(seq_key) {\r\n            if (__indexOf.call(combo.keys, \"shift\") >= 0) {\r\n              return true;\r\n            }\r\n            return seq_key !== \"shift\";\r\n          })).slice(-j);\r\n          if (combo.keys.length !== sequence.length) {\r\n            continue;\r\n          }\r\n          for (i = _k = 0, _ref2 = sequence.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {\r\n            seq_key = sequence[i];\r\n            if (__indexOf.call(combo.keys, \"shift\") < 0) {\r\n              if (seq_key === \"shift\") {\r\n                continue;\r\n              }\r\n            }\r\n            if (key === \"shift\" && __indexOf.call(combo.keys, \"shift\") < 0) {\r\n              continue;\r\n            }\r\n            if (combo.keys[i] === seq_key) {\r\n              match = true;\r\n            } else {\r\n              match = false;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        if (match) {\r\n          if (combo.is_exclusive) {\r\n            this._sequence = [];\r\n          }\r\n          return combo;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    Listener.prototype._receive_input = function(e, is_keydown) {\r\n      var key, _ref;\r\n      if (this._prevent_capture) {\r\n        if (this._keys_down.length) {\r\n          this._keys_down = [];\r\n        }\r\n        return;\r\n      }\r\n      key = _convert_key_to_readable((_ref = e.keyCode) != null ? _ref : e.key);\r\n      if (!is_keydown && !this._keys_down.length && (key === \"alt\" || key === _metakey)) {\r\n        return;\r\n      }\r\n      if (!key) {\r\n        return;\r\n      }\r\n      if (is_keydown) {\r\n        return this._key_down(key, e);\r\n      } else {\r\n        return this._key_up(key, e);\r\n      }\r\n    };\r\n\r\n    Listener.prototype._fire = function(event, combo, key_event, is_autorepeat) {\r\n      if (typeof combo[\"on_\" + event] === \"function\") {\r\n        this._prevent_default(key_event, combo[\"on_\" + event].call(combo[\"this\"], key_event, combo.count, is_autorepeat) !== true);\r\n      }\r\n      if (event === \"release\") {\r\n        combo.count = 0;\r\n      }\r\n      if (event === \"keyup\") {\r\n        return combo.keyup_fired = true;\r\n      }\r\n    };\r\n\r\n    Listener.prototype._match_combo_arrays = function(potential_match, match_handler) {\r\n      var source_combo, _i, _len, _ref;\r\n      _ref = this._registered_combos;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        source_combo = _ref[_i];\r\n        if ((!source_combo.is_unordered && _compare_arrays_sorted(potential_match, source_combo.keys)) || (source_combo.is_unordered && _compare_arrays(potential_match, source_combo.keys))) {\r\n          match_handler(source_combo);\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._fuzzy_match_combo_arrays = function(potential_match, match_handler) {\r\n      var source_combo, _i, _len, _ref;\r\n      _ref = this._registered_combos;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        source_combo = _ref[_i];\r\n        if ((!source_combo.is_unordered && _is_array_in_array_sorted(source_combo.keys, potential_match)) || (source_combo.is_unordered && _is_array_in_array(source_combo.keys, potential_match))) {\r\n          match_handler(source_combo);\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._keys_remain = function(combo) {\r\n      var key, keys_remain, _i, _len, _ref;\r\n      _ref = combo.keys;\r\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n        key = _ref[_i];\r\n        if (__indexOf.call(this._keys_down, key) >= 0) {\r\n          keys_remain = true;\r\n          break;\r\n        }\r\n      }\r\n      return keys_remain;\r\n    };\r\n\r\n    Listener.prototype._key_down = function(key, e) {\r\n      var combo, combos, event_mod, i, mod, potential, potential_combos, sequence_combo, shifted_key, _i, _j, _k, _len, _len1, _ref;\r\n      shifted_key = _convert_to_shifted_key(key, e);\r\n      if (shifted_key) {\r\n        key = shifted_key;\r\n      }\r\n      this._add_key_to_sequence(key, e);\r\n      sequence_combo = this._get_sequence(key);\r\n      if (sequence_combo) {\r\n        this._fire(\"keydown\", sequence_combo, e);\r\n      }\r\n      for (mod in _modifier_event_mapping) {\r\n        event_mod = _modifier_event_mapping[mod];\r\n        if (!e[event_mod]) {\r\n          continue;\r\n        }\r\n        if (mod === key || __indexOf.call(this._keys_down, mod) >= 0) {\r\n          continue;\r\n        }\r\n        this._keys_down.push(mod);\r\n      }\r\n      for (mod in _modifier_event_mapping) {\r\n        event_mod = _modifier_event_mapping[mod];\r\n        if (mod === key) {\r\n          continue;\r\n        }\r\n        if (__indexOf.call(this._keys_down, mod) >= 0 && !e[event_mod]) {\r\n          if (mod === \"cmd\" && _metakey !== \"cmd\") {\r\n            continue;\r\n          }\r\n          for (i = _i = 0, _ref = this._keys_down.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n            if (this._keys_down[i] === mod) {\r\n              this._keys_down.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      combos = this._get_active_combos(key);\r\n      potential_combos = this._get_potential_combos(key);\r\n      for (_j = 0, _len = combos.length; _j < _len; _j++) {\r\n        combo = combos[_j];\r\n        this._handle_combo_down(combo, potential_combos, key, e);\r\n      }\r\n      if (potential_combos.length) {\r\n        for (_k = 0, _len1 = potential_combos.length; _k < _len1; _k++) {\r\n          potential = potential_combos[_k];\r\n          this._prevent_default(e, potential.prevent_default);\r\n        }\r\n      }\r\n      if (__indexOf.call(this._keys_down, key) < 0) {\r\n        this._keys_down.push(key);\r\n      }\r\n    };\r\n\r\n    Listener.prototype._handle_combo_down = function(combo, potential_combos, key, e) {\r\n      var is_autorepeat, is_other_exclusive, potential_combo, result, _i, _len;\r\n      if (__indexOf.call(combo.keys, key) < 0) {\r\n        return false;\r\n      }\r\n      this._prevent_default(e, combo && combo.prevent_default);\r\n      is_autorepeat = false;\r\n      if (__indexOf.call(this._keys_down, key) >= 0) {\r\n        is_autorepeat = true;\r\n        if (!combo.allows_key_repeat()) {\r\n          return false;\r\n        }\r\n      }\r\n      result = this._add_to_active_combos(combo, key);\r\n      combo.keyup_fired = false;\r\n      is_other_exclusive = false;\r\n      if (combo.is_exclusive) {\r\n        for (_i = 0, _len = potential_combos.length; _i < _len; _i++) {\r\n          potential_combo = potential_combos[_i];\r\n          if (potential_combo.is_exclusive && potential_combo.keys.length > combo.keys.length) {\r\n            is_other_exclusive = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (!is_other_exclusive) {\r\n        if (combo.is_counting && typeof combo.on_keydown === \"function\") {\r\n          combo.count += 1;\r\n        }\r\n        if (result) {\r\n          return this._fire(\"keydown\", combo, e, is_autorepeat);\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._key_up = function(key, e) {\r\n      var active_combo, active_combos_length, combo, combos, i, sequence_combo, shifted_key, unshifted_key, _i, _j, _k, _l, _len, _len1, _len2, _ref, _ref1, _ref2, _ref3;\r\n      unshifted_key = key;\r\n      shifted_key = _convert_to_shifted_key(key, e);\r\n      if (shifted_key) {\r\n        key = shifted_key;\r\n      }\r\n      shifted_key = _keycode_shifted_keys[unshifted_key];\r\n      if (e.shiftKey) {\r\n        if (!(shifted_key && __indexOf.call(this._keys_down, shifted_key) >= 0)) {\r\n          key = unshifted_key;\r\n        }\r\n      } else {\r\n        if (!(unshifted_key && __indexOf.call(this._keys_down, unshifted_key) >= 0)) {\r\n          key = shifted_key;\r\n        }\r\n      }\r\n      sequence_combo = this._get_sequence(key);\r\n      if (sequence_combo) {\r\n        this._fire(\"keyup\", sequence_combo, e);\r\n      }\r\n      if (__indexOf.call(this._keys_down, key) < 0) {\r\n        return false;\r\n      }\r\n      for (i = _i = 0, _ref = this._keys_down.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n        if ((_ref1 = this._keys_down[i]) === key || _ref1 === shifted_key || _ref1 === unshifted_key) {\r\n          this._keys_down.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n      active_combos_length = this._active_combos.length;\r\n      combos = [];\r\n      _ref2 = this._active_combos;\r\n      for (_j = 0, _len = _ref2.length; _j < _len; _j++) {\r\n        active_combo = _ref2[_j];\r\n        if (__indexOf.call(active_combo.keys, key) >= 0) {\r\n          combos.push(active_combo);\r\n        }\r\n      }\r\n      for (_k = 0, _len1 = combos.length; _k < _len1; _k++) {\r\n        combo = combos[_k];\r\n        this._handle_combo_up(combo, e, key);\r\n      }\r\n      if (active_combos_length > 1) {\r\n        _ref3 = this._active_combos;\r\n        for (_l = 0, _len2 = _ref3.length; _l < _len2; _l++) {\r\n          active_combo = _ref3[_l];\r\n          if (active_combo === void 0 || __indexOf.call(combos, active_combo) >= 0) {\r\n            continue;\r\n          }\r\n          if (!this._keys_remain(active_combo)) {\r\n            this._remove_from_active_combos(active_combo);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    Listener.prototype._handle_combo_up = function(combo, e, key) {\r\n      var keys_down, keys_remaining;\r\n      this._prevent_default(e, combo && combo.prevent_default);\r\n      keys_remaining = this._keys_remain(combo);\r\n      if (!combo.keyup_fired) {\r\n        keys_down = this._keys_down.slice();\r\n        keys_down.push(key);\r\n        if (!combo.is_solitary || _compare_arrays(keys_down, combo.keys)) {\r\n          this._fire(\"keyup\", combo, e);\r\n          if (combo.is_counting && typeof combo.on_keyup === \"function\" && typeof combo.on_keydown !== \"function\") {\r\n            combo.count += 1;\r\n          }\r\n        }\r\n      }\r\n      if (!keys_remaining) {\r\n        this._fire(\"release\", combo, e);\r\n        this._remove_from_active_combos(combo);\r\n      }\r\n    };\r\n\r\n    Listener.prototype.simple_combo = function(keys, callback) {\r\n      return this.register_combo({\r\n        keys: keys,\r\n        on_keydown: callback\r\n      });\r\n    };\r\n\r\n    Listener.prototype.counting_combo = function(keys, count_callback) {\r\n      return this.register_combo({\r\n        keys: keys,\r\n        is_counting: true,\r\n        is_unordered: false,\r\n        on_keydown: count_callback\r\n      });\r\n    };\r\n\r\n    Listener.prototype.sequence_combo = function(keys, callback) {\r\n      return this.register_combo({\r\n        keys: keys,\r\n        on_keydown: callback,\r\n        is_sequence: true,\r\n        is_exclusive: true\r\n      });\r\n    };\r\n\r\n    Listener.prototype.register_combo = function(combo_dictionary) {\r\n      var combo, property, value, _ref;\r\n      if (typeof combo_dictionary[\"keys\"] === \"string\") {\r\n        combo_dictionary[\"keys\"] = combo_dictionary[\"keys\"].split(\" \");\r\n      }\r\n      _ref = this._defaults;\r\n      for (property in _ref) {\r\n        if (!__hasProp.call(_ref, property)) continue;\r\n        value = _ref[property];\r\n        if (combo_dictionary[property] === void 0) {\r\n          combo_dictionary[property] = value;\r\n        }\r\n      }\r\n      combo = new Combo(combo_dictionary);\r\n      if (_validate_combo(combo)) {\r\n        this._registered_combos.push(combo);\r\n        return combo;\r\n      }\r\n    };\r\n\r\n    Listener.prototype.register_many = function(combo_array) {\r\n      var combo, _i, _len, _results;\r\n      _results = [];\r\n      for (_i = 0, _len = combo_array.length; _i < _len; _i++) {\r\n        combo = combo_array[_i];\r\n        _results.push(this.register_combo(combo));\r\n      }\r\n      return _results;\r\n    };\r\n\r\n    Listener.prototype.unregister_combo = function(keys_or_combo) {\r\n      var combo, unregister_combo, _i, _len, _ref, _results;\r\n      if (!keys_or_combo) {\r\n        return false;\r\n      }\r\n      unregister_combo = (function(_this) {\r\n        return function(combo) {\r\n          var i, _i, _ref, _results;\r\n          _results = [];\r\n          for (i = _i = 0, _ref = _this._registered_combos.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n            if (combo === _this._registered_combos[i]) {\r\n              _this._registered_combos.splice(i, 1);\r\n              break;\r\n            } else {\r\n              _results.push(void 0);\r\n            }\r\n          }\r\n          return _results;\r\n        };\r\n      })(this);\r\n      if (keys_or_combo instanceof Combo) {\r\n        return unregister_combo(keys_or_combo);\r\n      } else {\r\n        if (typeof keys_or_combo === \"string\") {\r\n          keys_or_combo = keys_or_combo.split(\" \");\r\n        }\r\n        _ref = this._registered_combos;\r\n        _results = [];\r\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n          combo = _ref[_i];\r\n          if (combo == null) {\r\n            continue;\r\n          }\r\n          if ((combo.is_unordered && _compare_arrays(keys_or_combo, combo.keys)) || (!combo.is_unordered && _compare_arrays_sorted(keys_or_combo, combo.keys))) {\r\n            _results.push(unregister_combo(combo));\r\n          } else {\r\n            _results.push(void 0);\r\n          }\r\n        }\r\n        return _results;\r\n      }\r\n    };\r\n\r\n    Listener.prototype.unregister_many = function(combo_array) {\r\n      var combo, _i, _len, _results;\r\n      _results = [];\r\n      for (_i = 0, _len = combo_array.length; _i < _len; _i++) {\r\n        combo = combo_array[_i];\r\n        _results.push(this.unregister_combo(combo));\r\n      }\r\n      return _results;\r\n    };\r\n\r\n    Listener.prototype.get_registered_combos = function() {\r\n      return this._registered_combos;\r\n    };\r\n\r\n    Listener.prototype.reset = function() {\r\n      return this._registered_combos = [];\r\n    };\r\n\r\n    Listener.prototype.listen = function() {\r\n      return this._prevent_capture = false;\r\n    };\r\n\r\n    Listener.prototype.stop_listening = function() {\r\n      return this._prevent_capture = true;\r\n    };\r\n\r\n    Listener.prototype.get_meta_key = function() {\r\n      return _metakey;\r\n    };\r\n\r\n    return Listener;\r\n\r\n  })();\r\n\r\n  _decide_meta_key = function() {\r\n    if (navigator.userAgent.indexOf(\"Mac OS X\") !== -1) {\r\n      _metakey = \"cmd\";\r\n    }\r\n  };\r\n\r\n  _change_keycodes_by_browser = function() {\r\n    if (navigator.userAgent.indexOf(\"Opera\") !== -1) {\r\n      _keycode_dictionary[\"17\"] = \"cmd\";\r\n    }\r\n  };\r\n\r\n  _convert_key_to_readable = function(k) {\r\n    return _keycode_dictionary[k];\r\n  };\r\n\r\n  _filter_array = function(array, callback) {\r\n    var element;\r\n    if (array.filter) {\r\n      return array.filter(callback);\r\n    } else {\r\n      return (function() {\r\n        var _i, _len, _results;\r\n        _results = [];\r\n        for (_i = 0, _len = array.length; _i < _len; _i++) {\r\n          element = array[_i];\r\n          if (callback(element)) {\r\n            _results.push(element);\r\n          }\r\n        }\r\n        return _results;\r\n      })();\r\n    }\r\n  };\r\n\r\n  _compare_arrays = function(a1, a2) {\r\n    var item, _i, _len;\r\n    if (a1.length !== a2.length) {\r\n      return false;\r\n    }\r\n    for (_i = 0, _len = a1.length; _i < _len; _i++) {\r\n      item = a1[_i];\r\n      if (__indexOf.call(a2, item) >= 0) {\r\n        continue;\r\n      }\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _compare_arrays_sorted = function(a1, a2) {\r\n    var i, _i, _ref;\r\n    if (a1.length !== a2.length) {\r\n      return false;\r\n    }\r\n    for (i = _i = 0, _ref = a1.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n      if (a1[i] !== a2[i]) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _is_array_in_array = function(a1, a2) {\r\n    var item, _i, _len;\r\n    for (_i = 0, _len = a1.length; _i < _len; _i++) {\r\n      item = a1[_i];\r\n      if (__indexOf.call(a2, item) < 0) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _index_of_in_array = Array.prototype.indexOf || function(a, item) {\r\n    var i, _i, _ref;\r\n    for (i = _i = 0, _ref = a.length; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n      if (a[i] === item) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  };\r\n\r\n  _is_array_in_array_sorted = function(a1, a2) {\r\n    var index, item, prev, _i, _len;\r\n    prev = 0;\r\n    for (_i = 0, _len = a1.length; _i < _len; _i++) {\r\n      item = a1[_i];\r\n      index = _index_of_in_array.call(a2, item);\r\n      if (index >= prev) {\r\n        prev = index;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _log_error = function() {\r\n    if (keypress.debug) {\r\n      return console.log.apply(console, arguments);\r\n    }\r\n  };\r\n\r\n  _key_is_valid = function(key) {\r\n    var valid, valid_key, _;\r\n    valid = false;\r\n    for (_ in _keycode_dictionary) {\r\n      valid_key = _keycode_dictionary[_];\r\n      if (key === valid_key) {\r\n        valid = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!valid) {\r\n      for (_ in _keycode_shifted_keys) {\r\n        valid_key = _keycode_shifted_keys[_];\r\n        if (key === valid_key) {\r\n          valid = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return valid;\r\n  };\r\n\r\n  _validate_combo = function(combo) {\r\n    var alt_name, i, key, mod_key, non_modifier_keys, property, validated, value, _i, _j, _k, _len, _len1, _ref, _ref1;\r\n    validated = true;\r\n    if (!combo.keys.length) {\r\n      _log_error(\"You're trying to bind a combo with no keys:\", combo);\r\n    }\r\n    for (i = _i = 0, _ref = combo.keys.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {\r\n      key = combo.keys[i];\r\n      alt_name = _keycode_alternate_names[key];\r\n      if (alt_name) {\r\n        key = combo.keys[i] = alt_name;\r\n      }\r\n      if (key === \"meta\") {\r\n        combo.keys.splice(i, 1, _metakey);\r\n      }\r\n      if (key === \"cmd\") {\r\n        _log_error(\"Warning: use the \\\"meta\\\" key rather than \\\"cmd\\\" for Windows compatibility\");\r\n      }\r\n    }\r\n    _ref1 = combo.keys;\r\n    for (_j = 0, _len = _ref1.length; _j < _len; _j++) {\r\n      key = _ref1[_j];\r\n      if (!_key_is_valid(key)) {\r\n        _log_error(\"Do not recognize the key \\\"\" + key + \"\\\"\");\r\n        validated = false;\r\n      }\r\n    }\r\n    if (__indexOf.call(combo.keys, \"meta\") >= 0 || __indexOf.call(combo.keys, \"cmd\") >= 0) {\r\n      non_modifier_keys = combo.keys.slice();\r\n      for (_k = 0, _len1 = _modifier_keys.length; _k < _len1; _k++) {\r\n        mod_key = _modifier_keys[_k];\r\n        if ((i = _index_of_in_array.call(non_modifier_keys, mod_key)) > -1) {\r\n          non_modifier_keys.splice(i, 1);\r\n        }\r\n      }\r\n      if (non_modifier_keys.length > 1) {\r\n        _log_error(\"META and CMD key combos cannot have more than 1 non-modifier keys\", combo, non_modifier_keys);\r\n        validated = false;\r\n      }\r\n    }\r\n    for (property in combo) {\r\n      value = combo[property];\r\n      if (_factory_defaults[property] === \"undefined\") {\r\n        _log_error(\"The property \" + property + \" is not a valid combo property. Your combo has still been registered.\");\r\n      }\r\n    }\r\n    return validated;\r\n  };\r\n\r\n  _convert_to_shifted_key = function(key, e) {\r\n    var k;\r\n    if (!e.shiftKey) {\r\n      return false;\r\n    }\r\n    k = _keycode_shifted_keys[key];\r\n    if (k != null) {\r\n      return k;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  _modifier_event_mapping = {\r\n    \"cmd\": \"metaKey\",\r\n    \"ctrl\": \"ctrlKey\",\r\n    \"shift\": \"shiftKey\",\r\n    \"alt\": \"altKey\"\r\n  };\r\n\r\n  _keycode_alternate_names = {\r\n    \"escape\": \"esc\",\r\n    \"control\": \"ctrl\",\r\n    \"command\": \"cmd\",\r\n    \"break\": \"pause\",\r\n    \"windows\": \"cmd\",\r\n    \"option\": \"alt\",\r\n    \"caps_lock\": \"caps\",\r\n    \"apostrophe\": \"\\'\",\r\n    \"semicolon\": \";\",\r\n    \"tilde\": \"~\",\r\n    \"accent\": \"`\",\r\n    \"scroll_lock\": \"scroll\",\r\n    \"num_lock\": \"num\"\r\n  };\r\n\r\n  _keycode_shifted_keys = {\r\n    \"/\": \"?\",\r\n    \".\": \">\",\r\n    \",\": \"<\",\r\n    \"\\'\": \"\\\"\",\r\n    \";\": \":\",\r\n    \"[\": \"{\",\r\n    \"]\": \"}\",\r\n    \"\\\\\": \"|\",\r\n    \"`\": \"~\",\r\n    \"=\": \"+\",\r\n    \"-\": \"_\",\r\n    \"1\": \"!\",\r\n    \"2\": \"@\",\r\n    \"3\": \"#\",\r\n    \"4\": \"$\",\r\n    \"5\": \"%\",\r\n    \"6\": \"^\",\r\n    \"7\": \"&\",\r\n    \"8\": \"*\",\r\n    \"9\": \"(\",\r\n    \"0\": \")\"\r\n  };\r\n\r\n  _keycode_dictionary = {\r\n    0: \"\\\\\",\r\n    8: \"backspace\",\r\n    9: \"tab\",\r\n    12: \"num\",\r\n    13: \"enter\",\r\n    16: \"shift\",\r\n    17: \"ctrl\",\r\n    18: \"alt\",\r\n    19: \"pause\",\r\n    20: \"caps\",\r\n    27: \"esc\",\r\n    32: \"space\",\r\n    33: \"pageup\",\r\n    34: \"pagedown\",\r\n    35: \"end\",\r\n    36: \"home\",\r\n    37: \"left\",\r\n    38: \"up\",\r\n    39: \"right\",\r\n    40: \"down\",\r\n    44: \"print\",\r\n    45: \"insert\",\r\n    46: \"delete\",\r\n    48: \"0\",\r\n    49: \"1\",\r\n    50: \"2\",\r\n    51: \"3\",\r\n    52: \"4\",\r\n    53: \"5\",\r\n    54: \"6\",\r\n    55: \"7\",\r\n    56: \"8\",\r\n    57: \"9\",\r\n    65: \"a\",\r\n    66: \"b\",\r\n    67: \"c\",\r\n    68: \"d\",\r\n    69: \"e\",\r\n    70: \"f\",\r\n    71: \"g\",\r\n    72: \"h\",\r\n    73: \"i\",\r\n    74: \"j\",\r\n    75: \"k\",\r\n    76: \"l\",\r\n    77: \"m\",\r\n    78: \"n\",\r\n    79: \"o\",\r\n    80: \"p\",\r\n    81: \"q\",\r\n    82: \"r\",\r\n    83: \"s\",\r\n    84: \"t\",\r\n    85: \"u\",\r\n    86: \"v\",\r\n    87: \"w\",\r\n    88: \"x\",\r\n    89: \"y\",\r\n    90: \"z\",\r\n    91: \"cmd\",\r\n    92: \"cmd\",\r\n    93: \"cmd\",\r\n    96: \"num_0\",\r\n    97: \"num_1\",\r\n    98: \"num_2\",\r\n    99: \"num_3\",\r\n    100: \"num_4\",\r\n    101: \"num_5\",\r\n    102: \"num_6\",\r\n    103: \"num_7\",\r\n    104: \"num_8\",\r\n    105: \"num_9\",\r\n    106: \"num_multiply\",\r\n    107: \"num_add\",\r\n    108: \"num_enter\",\r\n    109: \"num_subtract\",\r\n    110: \"num_decimal\",\r\n    111: \"num_divide\",\r\n    112: \"f1\",\r\n    113: \"f2\",\r\n    114: \"f3\",\r\n    115: \"f4\",\r\n    116: \"f5\",\r\n    117: \"f6\",\r\n    118: \"f7\",\r\n    119: \"f8\",\r\n    120: \"f9\",\r\n    121: \"f10\",\r\n    122: \"f11\",\r\n    123: \"f12\",\r\n    124: \"print\",\r\n    144: \"num\",\r\n    145: \"scroll\",\r\n    186: \";\",\r\n    187: \"=\",\r\n    188: \",\",\r\n    189: \"-\",\r\n    190: \".\",\r\n    191: \"/\",\r\n    192: \"`\",\r\n    219: \"[\",\r\n    220: \"\\\\\",\r\n    221: \"]\",\r\n    222: \"\\'\",\r\n    223: \"`\",\r\n    224: \"cmd\",\r\n    225: \"alt\",\r\n    57392: \"ctrl\",\r\n    63289: \"num\",\r\n    59: \";\",\r\n    61: \"=\",\r\n    173: \"-\"\r\n  };\r\n\r\n  keypress._keycode_dictionary = _keycode_dictionary;\r\n\r\n  keypress._is_array_in_array_sorted = _is_array_in_array_sorted;\r\n\r\n  _decide_meta_key();\r\n\r\n  _change_keycodes_by_browser();\r\n\r\n  if (typeof define === \"function\" && define.amd) {\r\n    define([], function() {\r\n      return keypress;\r\n    });\r\n  } else if (typeof exports !== \"undefined\" && exports !== null) {\r\n    exports.keypress = keypress;\r\n  } else {\r\n    window.keypress = keypress;\r\n  }\r\n\r\n}).call(this);\r\n","// stats.js - http://github.com/mrdoob/stats.js\r\nvar Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?\"block\":\"none\";l=a}var l=0,c=document.createElement(\"div\");c.style.cssText=\"position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000\";c.addEventListener(\"click\",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel(\"FPS\",\"#0ff\",\"#002\")),f=h(new Stats.Panel(\"MS\",\"#0f0\",\"#020\"));\r\nif(self.performance&&self.performance.memory)var t=h(new Stats.Panel(\"MB\",\"#f08\",\"#201\"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1E3&&(r.update(1E3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};\r\nStats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement(\"canvas\");q.width=r;q.height=f;q.style.cssText=\"width:80px;height:48px\";var b=q.getContext(\"2d\");b.font=\"bold \"+9*a+\"px Helvetica,Arial,sans-serif\";b.textBaseline=\"top\";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,\r\nv){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+\" \"+h+\" (\"+e(c)+\"-\"+e(g)+\")\",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};\"object\"===typeof module&&(module.exports=Stats);\r\n","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\r\n} catch (e) {\r\n\t// This works if the window reference is available\r\n\tif (typeof window === \"object\") g = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n"],"sourceRoot":""}